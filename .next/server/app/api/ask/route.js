/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/ask/route";
exports.ids = ["app/api/ask/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

"use strict";
module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fask%2Froute&page=%2Fapi%2Fask%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fask%2Froute.ts&appDir=%2FUsers%2Falex%2FWebstormProjects%2Fpersonal-rag-agent%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falex%2FWebstormProjects%2Fpersonal-rag-agent&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fask%2Froute&page=%2Fapi%2Fask%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fask%2Froute.ts&appDir=%2FUsers%2Falex%2FWebstormProjects%2Fpersonal-rag-agent%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falex%2FWebstormProjects%2Fpersonal-rag-agent&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_alex_WebstormProjects_personal_rag_agent_app_api_ask_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/ask/route.ts */ \"(rsc)/./app/api/ask/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/ask/route\",\n        pathname: \"/api/ask\",\n        filename: \"route\",\n        bundlePath: \"app/api/ask/route\"\n    },\n    resolvedPagePath: \"/Users/alex/WebstormProjects/personal-rag-agent/app/api/ask/route.ts\",\n    nextConfigOutput,\n    userland: _Users_alex_WebstormProjects_personal_rag_agent_app_api_ask_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhc2slMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmFzayUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmFzayUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmFsZXglMkZXZWJzdG9ybVByb2plY3RzJTJGcGVyc29uYWwtcmFnLWFnZW50JTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmFsZXglMkZXZWJzdG9ybVByb2plY3RzJTJGcGVyc29uYWwtcmFnLWFnZW50JmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUNvQjtBQUNqRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNEQUFzRDtBQUM5RDtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUMwRjs7QUFFMUYiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vPzczN2EiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9Vc2Vycy9hbGV4L1dlYnN0b3JtUHJvamVjdHMvcGVyc29uYWwtcmFnLWFnZW50L2FwcC9hcGkvYXNrL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hc2svcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hc2tcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2Fzay9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9hbGV4L1dlYnN0b3JtUHJvamVjdHMvcGVyc29uYWwtcmFnLWFnZW50L2FwcC9hcGkvYXNrL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fask%2Froute&page=%2Fapi%2Fask%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fask%2Froute.ts&appDir=%2FUsers%2Falex%2FWebstormProjects%2Fpersonal-rag-agent%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falex%2FWebstormProjects%2Fpersonal-rag-agent&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./app/api/ask/route.ts":
/*!******************************!*\
  !*** ./app/api/ask/route.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var _lib_modelProvider__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/modelProvider */ \"(rsc)/./lib/modelProvider.ts\");\n/* harmony import */ var _lib_prompt__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/prompt */ \"(rsc)/./lib/prompt.ts\");\n\n\n\n\n\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_3__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nfunction approxTokenLen(s) {\n    return Math.ceil(s.length / 4);\n}\nfunction dedupeAndMerge(matches) {\n    const seen = new Set();\n    const unique = [];\n    for (const m of matches){\n        const key = `${m.document_id}:${m.chunk_text.slice(0, 100)}`;\n        if (!seen.has(key)) {\n            seen.add(key);\n            unique.push(m);\n        }\n    }\n    return unique;\n}\nfunction cleanJSON(raw) {\n    return raw.replace(/```json\\s*/g, '').replace(/```\\s*/g, '').trim();\n}\nasync function POST(request) {\n    const t0 = Date.now();\n    try {\n        const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_4__.createClient)(\"https://zqharntcylmxxdcvbtqi.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY);\n        const token = request.headers.get(\"authorization\")?.replace(\"Bearer \", \"\");\n        if (!token) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Не авторизован\"\n        }, {\n            status: 401\n        });\n        const { data: { user }, error: authError } = await supabase.auth.getUser(token);\n        if (authError || !user) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Не авторизован\"\n        }, {\n            status: 401\n        });\n        const body = await request.json();\n        const { question, provider, projectId, role } = body;\n        if (!question?.trim()) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Вопрос не предоставлен\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(`Вопрос: \"${question}\" | Проект: ${projectId} | Роль: ${role}`);\n        // Проверяем количество чанков\n        let countQuery = supabase.from(\"doc_chunks\").select(\"*\", {\n            count: \"exact\",\n            head: true\n        }).eq(\"user_id\", user.id);\n        // Фильтруем по проекту если указан\n        if (projectId && projectId !== 'null') {\n            countQuery = countQuery.eq(\"project_id\", projectId);\n        }\n        const { count } = await countQuery;\n        if (!count) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                answer: \"Не нашёл релевантной информации в документах проекта. Попробуйте переформулировать вопрос.\",\n                question\n            });\n        }\n        console.log(`Найдено ${count} чанков в проекте`);\n        console.log('Генерация эмбеддинга...');\n        const embedRes = await openai.embeddings.create({\n            model: \"text-embedding-3-small\",\n            input: question\n        });\n        const queryEmbedding = embedRes.data[0].embedding;\n        console.log('Поиск релевантных чанков...');\n        const { data: matches, error: matchError } = await supabase.rpc(\"match_doc_chunks\", {\n            query_embedding: queryEmbedding,\n            match_threshold: 0.25,\n            match_count: 15,\n            filter_user_id: user.id,\n            filter_project_id: projectId && projectId !== 'null' ? projectId : null\n        });\n        if (matchError) {\n            console.error('Match error:', matchError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: matchError.message\n            }, {\n                status: 500\n            });\n        }\n        if (!matches?.length) {\n            console.log('Не найдено релевантных чанков');\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                answer: \"Не нашёл релевантной информации в документах проекта. Попробуйте переформулировать вопрос.\",\n                question\n            });\n        }\n        console.log(`Найдено ${matches.length} релевантных чанков`);\n        const uniq = dedupeAndMerge(matches).slice(0, 10);\n        const chunks = uniq.map((m)=>({\n                doc_id: m.document_id,\n                chunk_index: m.chunk_index ?? 0,\n                similarity: m.similarity ?? 0,\n                text: (m.chunk_text || \"\").slice(0, 2000)\n            }));\n        const ctxTokens = approxTokenLen(chunks.map((c)=>c.text).join(\" \"));\n        const providerFinal = provider ?? (ctxTokens > 120000 ? \"anthropic\" : \"openai\");\n        console.log(`Используется провайдер: ${providerFinal}, контекст: ${ctxTokens} токенов`);\n        // Добавляем роль в системный промпт если она указана\n        let systemPrompt = _lib_prompt__WEBPACK_IMPORTED_MODULE_2__.SYSTEM_RAG;\n        if (role && role !== 'analyst') {\n            systemPrompt = `${role}\\n\\n${_lib_prompt__WEBPACK_IMPORTED_MODULE_2__.SYSTEM_RAG}`;\n        }\n        const userPrompt = (0,_lib_prompt__WEBPACK_IMPORTED_MODULE_2__.buildUserPrompt)(question, chunks);\n        console.log('Запрос к модели...');\n        const raw = await (0,_lib_modelProvider__WEBPACK_IMPORTED_MODULE_1__.chatWithProvider)(providerFinal, {\n            system: systemPrompt,\n            user: userPrompt,\n            maxTokens: 4000\n        });\n        console.log(`Raw ответ (${raw.length} символов):`, raw.substring(0, 200));\n        let parsed = null;\n        try {\n            const cleaned = cleanJSON(raw);\n            if (cleaned) {\n                parsed = JSON.parse(cleaned);\n                console.log('JSON успешно распарсен');\n            }\n        } catch (e) {\n            console.error('JSON parse error:', e);\n        }\n        const answer = parsed?.answer || raw || \"Ошибка: пустой ответ от модели\";\n        const citations = parsed?.citations || chunks.slice(0, 3).map((c)=>({\n                doc_id: c.doc_id,\n                chunk_index: c.chunk_index,\n                similarity: c.similarity,\n                quote: c.text.slice(0, 200)\n            }));\n        const insights = parsed?.insights || [];\n        const follow_up_questions = parsed?.follow_up_questions || [];\n        console.log(`Ответ получен. Insights: ${insights.length}, Follow-ups: ${follow_up_questions.length}`);\n        const latency = Date.now() - t0;\n        // Сохраняем сообщения с project_id\n        await supabase.from(\"messages\").insert([\n            {\n                user_id: user.id,\n                role: \"user\",\n                content: question,\n                project_id: projectId && projectId !== 'null' ? projectId : null\n            },\n            {\n                user_id: user.id,\n                role: \"assistant\",\n                content: answer,\n                project_id: projectId && projectId !== 'null' ? projectId : null,\n                metadata: {\n                    provider: providerFinal,\n                    latency_ms: latency,\n                    sources: citations,\n                    insights,\n                    follow_up_questions\n                }\n            }\n        ]);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            answer,\n            question,\n            sources: citations,\n            insights,\n            follow_up_questions,\n            provider: providerFinal,\n            latency_ms: latency\n        });\n    } catch (err) {\n        console.error('Error:', err);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: err?.message || \"Unknown error\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2Fzay9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBd0Q7QUFDSDtBQUN6QjtBQUNrQztBQUNJO0FBRWxFLE1BQU1NLFNBQVMsSUFBSUosOENBQU1BLENBQUM7SUFBRUssUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxjQUFjO0FBQUM7QUFFL0QsU0FBU0MsZUFBZUMsQ0FBUztJQUMvQixPQUFPQyxLQUFLQyxJQUFJLENBQUNGLEVBQUVHLE1BQU0sR0FBRztBQUM5QjtBQUVBLFNBQVNDLGVBQWVDLE9BQWM7SUFDcEMsTUFBTUMsT0FBTyxJQUFJQztJQUNqQixNQUFNQyxTQUFTLEVBQUU7SUFDakIsS0FBSyxNQUFNQyxLQUFLSixRQUFTO1FBQ3ZCLE1BQU1LLE1BQU0sR0FBR0QsRUFBRUUsV0FBVyxDQUFDLENBQUMsRUFBRUYsRUFBRUcsVUFBVSxDQUFDQyxLQUFLLENBQUMsR0FBRyxNQUFNO1FBQzVELElBQUksQ0FBQ1AsS0FBS1EsR0FBRyxDQUFDSixNQUFNO1lBQ2xCSixLQUFLUyxHQUFHLENBQUNMO1lBQ1RGLE9BQU9RLElBQUksQ0FBQ1A7UUFDZDtJQUNGO0lBQ0EsT0FBT0Q7QUFDVDtBQUVBLFNBQVNTLFVBQVVDLEdBQVc7SUFDNUIsT0FBT0EsSUFDRkMsT0FBTyxDQUFDLGVBQWUsSUFDdkJBLE9BQU8sQ0FBQyxXQUFXLElBQ25CQyxJQUFJO0FBQ1g7QUFFTyxlQUFlQyxLQUFLQyxPQUFvQjtJQUM3QyxNQUFNQyxLQUFLQyxLQUFLQyxHQUFHO0lBRW5CLElBQUk7UUFDRixNQUFNQyxXQUFXckMsbUVBQVlBLENBQ3pCTywwQ0FBb0MsRUFDcENBLFFBQVFDLEdBQUcsQ0FBQytCLHlCQUF5QjtRQUd6QyxNQUFNQyxRQUFRUCxRQUFRUSxPQUFPLENBQUNDLEdBQUcsQ0FBQyxrQkFBa0JaLFFBQVEsV0FBVztRQUN2RSxJQUFJLENBQUNVLE9BQU8sT0FBT3pDLHFEQUFZQSxDQUFDNEMsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBaUIsR0FBRztZQUFFQyxRQUFRO1FBQUk7UUFFaEYsTUFBTSxFQUFFQyxNQUFNLEVBQUVDLElBQUksRUFBRSxFQUFFSCxPQUFPSSxTQUFTLEVBQUUsR0FBRyxNQUFNWCxTQUFTWSxJQUFJLENBQUNDLE9BQU8sQ0FBQ1Y7UUFDekUsSUFBSVEsYUFBYSxDQUFDRCxNQUFNLE9BQU9oRCxxREFBWUEsQ0FBQzRDLElBQUksQ0FBQztZQUFFQyxPQUFPO1FBQWlCLEdBQUc7WUFBRUMsUUFBUTtRQUFJO1FBRTVGLE1BQU1NLE9BQU8sTUFBTWxCLFFBQVFVLElBQUk7UUFDL0IsTUFBTSxFQUFFUyxRQUFRLEVBQUVDLFFBQVEsRUFBRUMsU0FBUyxFQUFFQyxJQUFJLEVBQUUsR0FBR0o7UUFFaEQsSUFBSSxDQUFDQyxVQUFVckIsUUFBUTtZQUNyQixPQUFPaEMscURBQVlBLENBQUM0QyxJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBeUIsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQzlFO1FBRUFXLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsRUFBRUwsU0FBUyxZQUFZLEVBQUVFLFVBQVUsU0FBUyxFQUFFQyxNQUFNO1FBRTFFLDhCQUE4QjtRQUM5QixJQUFJRyxhQUFhckIsU0FDWnNCLElBQUksQ0FBQyxjQUNMQyxNQUFNLENBQUMsS0FBSztZQUFFQyxPQUFPO1lBQVNDLE1BQU07UUFBSyxHQUN6Q0MsRUFBRSxDQUFDLFdBQVdoQixLQUFLaUIsRUFBRTtRQUUxQixtQ0FBbUM7UUFDbkMsSUFBSVYsYUFBYUEsY0FBYyxRQUFRO1lBQ3JDSSxhQUFhQSxXQUFXSyxFQUFFLENBQUMsY0FBY1Q7UUFDM0M7UUFFQSxNQUFNLEVBQUVPLEtBQUssRUFBRSxHQUFHLE1BQU1IO1FBRXhCLElBQUksQ0FBQ0csT0FBTztZQUNWLE9BQU85RCxxREFBWUEsQ0FBQzRDLElBQUksQ0FBQztnQkFDdkJzQixRQUFRO2dCQUNSYjtZQUNGO1FBQ0Y7UUFFQUksUUFBUUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFSSxNQUFNLGlCQUFpQixDQUFDO1FBRS9DTCxRQUFRQyxHQUFHLENBQUM7UUFDWixNQUFNUyxXQUFXLE1BQU03RCxPQUFPOEQsVUFBVSxDQUFDQyxNQUFNLENBQUM7WUFDOUNDLE9BQU87WUFDUEMsT0FBT2xCO1FBQ1Q7UUFDQSxNQUFNbUIsaUJBQWlCTCxTQUFTcEIsSUFBSSxDQUFDLEVBQUUsQ0FBQzBCLFNBQVM7UUFFakRoQixRQUFRQyxHQUFHLENBQUM7UUFDWixNQUFNLEVBQUVYLE1BQU05QixPQUFPLEVBQUU0QixPQUFPNkIsVUFBVSxFQUFFLEdBQUcsTUFBTXBDLFNBQVNxQyxHQUFHLENBQUMsb0JBQW9CO1lBQ2xGQyxpQkFBaUJKO1lBQ2pCSyxpQkFBaUI7WUFDakJDLGFBQWE7WUFDYkMsZ0JBQWdCL0IsS0FBS2lCLEVBQUU7WUFDdkJlLG1CQUFtQnpCLGFBQWFBLGNBQWMsU0FBU0EsWUFBWTtRQUNyRTtRQUVBLElBQUltQixZQUFZO1lBQ2RqQixRQUFRWixLQUFLLENBQUMsZ0JBQWdCNkI7WUFDOUIsT0FBTzFFLHFEQUFZQSxDQUFDNEMsSUFBSSxDQUFDO2dCQUFFQyxPQUFPNkIsV0FBV08sT0FBTztZQUFDLEdBQUc7Z0JBQUVuQyxRQUFRO1lBQUk7UUFDeEU7UUFFQSxJQUFJLENBQUM3QixTQUFTRixRQUFRO1lBQ3BCMEMsUUFBUUMsR0FBRyxDQUFDO1lBQ1osT0FBTzFELHFEQUFZQSxDQUFDNEMsSUFBSSxDQUFDO2dCQUN2QnNCLFFBQVE7Z0JBQ1JiO1lBQ0Y7UUFDRjtRQUVBSSxRQUFRQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUV6QyxRQUFRRixNQUFNLENBQUMsbUJBQW1CLENBQUM7UUFFMUQsTUFBTW1FLE9BQU9sRSxlQUFlQyxTQUFTUSxLQUFLLENBQUMsR0FBRztRQUM5QyxNQUFNMEQsU0FBU0QsS0FBS0UsR0FBRyxDQUFDLENBQUMvRCxJQUFZO2dCQUNuQ2dFLFFBQVFoRSxFQUFFRSxXQUFXO2dCQUNyQitELGFBQWFqRSxFQUFFaUUsV0FBVyxJQUFJO2dCQUM5QkMsWUFBWWxFLEVBQUVrRSxVQUFVLElBQUk7Z0JBQzVCQyxNQUFNLENBQUNuRSxFQUFFRyxVQUFVLElBQUksRUFBQyxFQUFHQyxLQUFLLENBQUMsR0FBRztZQUN0QztRQUVBLE1BQU1nRSxZQUFZOUUsZUFBZXdFLE9BQU9DLEdBQUcsQ0FBQ00sQ0FBQUEsSUFBS0EsRUFBRUYsSUFBSSxFQUFFRyxJQUFJLENBQUM7UUFDOUQsTUFBTUMsZ0JBQWdCLFlBQ2pCSCxDQUFBQSxZQUFZLFNBQVUsY0FBYyxRQUFPO1FBRWhEaEMsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0JBQXdCLEVBQUVrQyxjQUFjLFlBQVksRUFBRUgsVUFBVSxRQUFRLENBQUM7UUFFdEYscURBQXFEO1FBQ3JELElBQUlJLGVBQWV6RixtREFBVUE7UUFDN0IsSUFBSW9ELFFBQVFBLFNBQVMsV0FBVztZQUM5QnFDLGVBQWUsR0FBR3JDLEtBQUssSUFBSSxFQUFFcEQsbURBQVVBLEVBQUU7UUFDM0M7UUFFQSxNQUFNMEYsYUFBYXpGLDREQUFlQSxDQUFDZ0QsVUFBVThCO1FBRTdDMUIsUUFBUUMsR0FBRyxDQUFDO1FBQ1osTUFBTTVCLE1BQU0sTUFBTTNCLG9FQUFnQkEsQ0FBQ3lGLGVBQWU7WUFDaERHLFFBQVFGO1lBQ1I3QyxNQUFNOEM7WUFDTkUsV0FBVztRQUNiO1FBRUF2QyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUU1QixJQUFJZixNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUVlLElBQUltRSxTQUFTLENBQUMsR0FBRztRQUVwRSxJQUFJQyxTQUFjO1FBRWxCLElBQUk7WUFDRixNQUFNQyxVQUFVdEUsVUFBVUM7WUFDMUIsSUFBSXFFLFNBQVM7Z0JBQ1hELFNBQVNFLEtBQUtDLEtBQUssQ0FBQ0Y7Z0JBQ3BCMUMsUUFBUUMsR0FBRyxDQUFDO1lBQ2Q7UUFDRixFQUFFLE9BQU80QyxHQUFHO1lBQ1Y3QyxRQUFRWixLQUFLLENBQUMscUJBQXFCeUQ7UUFDckM7UUFFQSxNQUFNcEMsU0FBU2dDLFFBQVFoQyxVQUFVcEMsT0FBTztRQUN4QyxNQUFNeUUsWUFBWUwsUUFBUUssYUFBYXBCLE9BQU8xRCxLQUFLLENBQUMsR0FBRyxHQUFHMkQsR0FBRyxDQUFDTSxDQUFBQSxJQUFNO2dCQUNsRUwsUUFBUUssRUFBRUwsTUFBTTtnQkFDaEJDLGFBQWFJLEVBQUVKLFdBQVc7Z0JBQzFCQyxZQUFZRyxFQUFFSCxVQUFVO2dCQUN4QmlCLE9BQU9kLEVBQUVGLElBQUksQ0FBQy9ELEtBQUssQ0FBQyxHQUFHO1lBQ3pCO1FBRUEsTUFBTWdGLFdBQVdQLFFBQVFPLFlBQVksRUFBRTtRQUN2QyxNQUFNQyxzQkFBc0JSLFFBQVFRLHVCQUF1QixFQUFFO1FBRTdEakQsUUFBUUMsR0FBRyxDQUFDLENBQUMseUJBQXlCLEVBQUUrQyxTQUFTMUYsTUFBTSxDQUFDLGNBQWMsRUFBRTJGLG9CQUFvQjNGLE1BQU0sRUFBRTtRQUVwRyxNQUFNNEYsVUFBVXZFLEtBQUtDLEdBQUcsS0FBS0Y7UUFFN0IsbUNBQW1DO1FBQ25DLE1BQU1HLFNBQVNzQixJQUFJLENBQUMsWUFBWWdELE1BQU0sQ0FBQztZQUNyQztnQkFDRUMsU0FBUzdELEtBQUtpQixFQUFFO2dCQUNoQlQsTUFBTTtnQkFDTnNELFNBQVN6RDtnQkFDVDBELFlBQVl4RCxhQUFhQSxjQUFjLFNBQVNBLFlBQVk7WUFDOUQ7WUFDQTtnQkFDRXNELFNBQVM3RCxLQUFLaUIsRUFBRTtnQkFDaEJULE1BQU07Z0JBQ05zRCxTQUFTNUM7Z0JBQ1Q2QyxZQUFZeEQsYUFBYUEsY0FBYyxTQUFTQSxZQUFZO2dCQUM1RHlELFVBQVU7b0JBQ1IxRCxVQUFVc0M7b0JBQ1ZxQixZQUFZTjtvQkFDWk8sU0FBU1g7b0JBQ1RFO29CQUNBQztnQkFDRjtZQUNGO1NBQ0Q7UUFFRCxPQUFPMUcscURBQVlBLENBQUM0QyxJQUFJLENBQUM7WUFDdkJzQjtZQUNBYjtZQUNBNkQsU0FBU1g7WUFDVEU7WUFDQUM7WUFDQXBELFVBQVVzQztZQUNWcUIsWUFBWU47UUFDZDtJQUVGLEVBQUUsT0FBT1EsS0FBVTtRQUNqQjFELFFBQVFaLEtBQUssQ0FBQyxVQUFVc0U7UUFDeEIsT0FBT25ILHFEQUFZQSxDQUFDNEMsSUFBSSxDQUFDO1lBQ3ZCQyxPQUFPc0UsS0FBS2xDLFdBQVc7UUFDekIsR0FBRztZQUFFbkMsUUFBUTtRQUFJO0lBQ25CO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9hcHAvYXBpL2Fzay9yb3V0ZS50cz9iOWVlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcbmltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiO1xuaW1wb3J0IHsgY2hhdFdpdGhQcm92aWRlciB9IGZyb20gXCIuLi8uLi8uLi9saWIvbW9kZWxQcm92aWRlclwiO1xuaW1wb3J0IHsgU1lTVEVNX1JBRywgYnVpbGRVc2VyUHJvbXB0IH0gZnJvbSBcIi4uLy4uLy4uL2xpYi9wcm9tcHRcIjtcblxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7IGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkgfSk7XG5cbmZ1bmN0aW9uIGFwcHJveFRva2VuTGVuKHM6IHN0cmluZykge1xuICByZXR1cm4gTWF0aC5jZWlsKHMubGVuZ3RoIC8gNCk7XG59XG5cbmZ1bmN0aW9uIGRlZHVwZUFuZE1lcmdlKG1hdGNoZXM6IGFueVtdKSB7XG4gIGNvbnN0IHNlZW4gPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgY29uc3QgdW5pcXVlID0gW107XG4gIGZvciAoY29uc3QgbSBvZiBtYXRjaGVzKSB7XG4gICAgY29uc3Qga2V5ID0gYCR7bS5kb2N1bWVudF9pZH06JHttLmNodW5rX3RleHQuc2xpY2UoMCwgMTAwKX1gO1xuICAgIGlmICghc2Vlbi5oYXMoa2V5KSkge1xuICAgICAgc2Vlbi5hZGQoa2V5KTtcbiAgICAgIHVuaXF1ZS5wdXNoKG0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdW5pcXVlO1xufVxuXG5mdW5jdGlvbiBjbGVhbkpTT04ocmF3OiBzdHJpbmcpOiBzdHJpbmcge1xuICByZXR1cm4gcmF3XG4gICAgICAucmVwbGFjZSgvYGBganNvblxccyovZywgJycpXG4gICAgICAucmVwbGFjZSgvYGBgXFxzKi9nLCAnJylcbiAgICAgIC50cmltKCk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHQwID0gRGF0ZS5ub3coKTtcblxuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxuICAgICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgICAgICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIVxuICAgICk7XG5cbiAgICBjb25zdCB0b2tlbiA9IHJlcXVlc3QuaGVhZGVycy5nZXQoXCJhdXRob3JpemF0aW9uXCIpPy5yZXBsYWNlKFwiQmVhcmVyIFwiLCBcIlwiKTtcbiAgICBpZiAoIXRva2VuKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCLQndC1INCw0LLRgtC+0YDQuNC30L7QstCw0L1cIiB9LCB7IHN0YXR1czogNDAxIH0pO1xuXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSwgZXJyb3I6IGF1dGhFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKHRva2VuKTtcbiAgICBpZiAoYXV0aEVycm9yIHx8ICF1c2VyKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCLQndC1INCw0LLRgtC+0YDQuNC30L7QstCw0L1cIiB9LCB7IHN0YXR1czogNDAxIH0pO1xuXG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuICAgIGNvbnN0IHsgcXVlc3Rpb24sIHByb3ZpZGVyLCBwcm9qZWN0SWQsIHJvbGUgfSA9IGJvZHk7XG5cbiAgICBpZiAoIXF1ZXN0aW9uPy50cmltKCkpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcItCS0L7Qv9GA0L7RgSDQvdC1INC/0YDQtdC00L7RgdGC0LDQstC70LXQvVwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYNCS0L7Qv9GA0L7RgTogXCIke3F1ZXN0aW9ufVwiIHwg0J/RgNC+0LXQutGCOiAke3Byb2plY3RJZH0gfCDQoNC+0LvRjDogJHtyb2xlfWApO1xuXG4gICAgLy8g0J/RgNC+0LLQtdGA0Y/QtdC8INC60L7Qu9C40YfQtdGB0YLQstC+INGH0LDQvdC60L7QslxuICAgIGxldCBjb3VudFF1ZXJ5ID0gc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJkb2NfY2h1bmtzXCIpXG4gICAgICAgIC5zZWxlY3QoXCIqXCIsIHsgY291bnQ6IFwiZXhhY3RcIiwgaGVhZDogdHJ1ZSB9KVxuICAgICAgICAuZXEoXCJ1c2VyX2lkXCIsIHVzZXIuaWQpO1xuXG4gICAgLy8g0KTQuNC70YzRgtGA0YPQtdC8INC/0L4g0L/RgNC+0LXQutGC0YMg0LXRgdC70Lgg0YPQutCw0LfQsNC9XG4gICAgaWYgKHByb2plY3RJZCAmJiBwcm9qZWN0SWQgIT09ICdudWxsJykge1xuICAgICAgY291bnRRdWVyeSA9IGNvdW50UXVlcnkuZXEoXCJwcm9qZWN0X2lkXCIsIHByb2plY3RJZCk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBjb3VudCB9ID0gYXdhaXQgY291bnRRdWVyeTtcblxuICAgIGlmICghY291bnQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIGFuc3dlcjogXCLQndC1INC90LDRiNGR0Lsg0YDQtdC70LXQstCw0L3RgtC90L7QuSDQuNC90YTQvtGA0LzQsNGG0LjQuCDQsiDQtNC+0LrRg9C80LXQvdGC0LDRhSDQv9GA0L7QtdC60YLQsC4g0J/QvtC/0YDQvtCx0YPQudGC0LUg0L/QtdGA0LXRhNC+0YDQvNGD0LvQuNGA0L7QstCw0YLRjCDQstC+0L/RgNC+0YEuXCIsXG4gICAgICAgIHF1ZXN0aW9uLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYNCd0LDQudC00LXQvdC+ICR7Y291bnR9INGH0LDQvdC60L7QsiDQsiDQv9GA0L7QtdC60YLQtWApO1xuXG4gICAgY29uc29sZS5sb2coJ9CT0LXQvdC10YDQsNGG0LjRjyDRjdC80LHQtdC00LTQuNC90LPQsC4uLicpO1xuICAgIGNvbnN0IGVtYmVkUmVzID0gYXdhaXQgb3BlbmFpLmVtYmVkZGluZ3MuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBcInRleHQtZW1iZWRkaW5nLTMtc21hbGxcIixcbiAgICAgIGlucHV0OiBxdWVzdGlvblxuICAgIH0pO1xuICAgIGNvbnN0IHF1ZXJ5RW1iZWRkaW5nID0gZW1iZWRSZXMuZGF0YVswXS5lbWJlZGRpbmc7XG5cbiAgICBjb25zb2xlLmxvZygn0J/QvtC40YHQuiDRgNC10LvQtdCy0LDQvdGC0L3Ri9GFINGH0LDQvdC60L7Qsi4uLicpO1xuICAgIGNvbnN0IHsgZGF0YTogbWF0Y2hlcywgZXJyb3I6IG1hdGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYyhcIm1hdGNoX2RvY19jaHVua3NcIiwge1xuICAgICAgcXVlcnlfZW1iZWRkaW5nOiBxdWVyeUVtYmVkZGluZyxcbiAgICAgIG1hdGNoX3RocmVzaG9sZDogMC4yNSwgLy8g0KHQvdC40LfQuNC7INC/0L7RgNC+0LMg0LTQu9GPINC70YPRh9GI0LXQs9C+INC/0L7QuNGB0LrQsFxuICAgICAgbWF0Y2hfY291bnQ6IDE1LCAgICAgIC8vINCj0LLQtdC70LjRh9C40Lsg0LrQvtC70LjRh9C10YHRgtCy0L5cbiAgICAgIGZpbHRlcl91c2VyX2lkOiB1c2VyLmlkLFxuICAgICAgZmlsdGVyX3Byb2plY3RfaWQ6IHByb2plY3RJZCAmJiBwcm9qZWN0SWQgIT09ICdudWxsJyA/IHByb2plY3RJZCA6IG51bGxcbiAgICB9KTtcblxuICAgIGlmIChtYXRjaEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNYXRjaCBlcnJvcjonLCBtYXRjaEVycm9yKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBtYXRjaEVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG5cbiAgICBpZiAoIW1hdGNoZXM/Lmxlbmd0aCkge1xuICAgICAgY29uc29sZS5sb2coJ9Cd0LUg0L3QsNC50LTQtdC90L4g0YDQtdC70LXQstCw0L3RgtC90YvRhSDRh9Cw0L3QutC+0LInKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICAgIGFuc3dlcjogXCLQndC1INC90LDRiNGR0Lsg0YDQtdC70LXQstCw0L3RgtC90L7QuSDQuNC90YTQvtGA0LzQsNGG0LjQuCDQsiDQtNC+0LrRg9C80LXQvdGC0LDRhSDQv9GA0L7QtdC60YLQsC4g0J/QvtC/0YDQvtCx0YPQudGC0LUg0L/QtdGA0LXRhNC+0YDQvNGD0LvQuNGA0L7QstCw0YLRjCDQstC+0L/RgNC+0YEuXCIsXG4gICAgICAgIHF1ZXN0aW9uXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg0J3QsNC50LTQtdC90L4gJHttYXRjaGVzLmxlbmd0aH0g0YDQtdC70LXQstCw0L3RgtC90YvRhSDRh9Cw0L3QutC+0LJgKTtcblxuICAgIGNvbnN0IHVuaXEgPSBkZWR1cGVBbmRNZXJnZShtYXRjaGVzKS5zbGljZSgwLCAxMCk7XG4gICAgY29uc3QgY2h1bmtzID0gdW5pcS5tYXAoKG06IGFueSkgPT4gKHtcbiAgICAgIGRvY19pZDogbS5kb2N1bWVudF9pZCxcbiAgICAgIGNodW5rX2luZGV4OiBtLmNodW5rX2luZGV4ID8/IDAsXG4gICAgICBzaW1pbGFyaXR5OiBtLnNpbWlsYXJpdHkgPz8gMCxcbiAgICAgIHRleHQ6IChtLmNodW5rX3RleHQgfHwgXCJcIikuc2xpY2UoMCwgMjAwMClcbiAgICB9KSk7XG5cbiAgICBjb25zdCBjdHhUb2tlbnMgPSBhcHByb3hUb2tlbkxlbihjaHVua3MubWFwKGMgPT4gYy50ZXh0KS5qb2luKFwiIFwiKSk7XG4gICAgY29uc3QgcHJvdmlkZXJGaW5hbCA9IChwcm92aWRlciBhcyBcIm9wZW5haVwiIHwgXCJhbnRocm9waWNcIikgPz9cbiAgICAgICAgKGN0eFRva2VucyA+IDEyMF8wMDAgPyBcImFudGhyb3BpY1wiIDogXCJvcGVuYWlcIik7XG5cbiAgICBjb25zb2xlLmxvZyhg0JjRgdC/0L7Qu9GM0LfRg9C10YLRgdGPINC/0YDQvtCy0LDQudC00LXRgDogJHtwcm92aWRlckZpbmFsfSwg0LrQvtC90YLQtdC60YHRgjogJHtjdHhUb2tlbnN9INGC0L7QutC10L3QvtCyYCk7XG5cbiAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YDQvtC70Ywg0LIg0YHQuNGB0YLQtdC80L3Ri9C5INC/0YDQvtC80L/RgiDQtdGB0LvQuCDQvtC90LAg0YPQutCw0LfQsNC90LBcbiAgICBsZXQgc3lzdGVtUHJvbXB0ID0gU1lTVEVNX1JBRztcbiAgICBpZiAocm9sZSAmJiByb2xlICE9PSAnYW5hbHlzdCcpIHtcbiAgICAgIHN5c3RlbVByb21wdCA9IGAke3JvbGV9XFxuXFxuJHtTWVNURU1fUkFHfWA7XG4gICAgfVxuXG4gICAgY29uc3QgdXNlclByb21wdCA9IGJ1aWxkVXNlclByb21wdChxdWVzdGlvbiwgY2h1bmtzKTtcblxuICAgIGNvbnNvbGUubG9nKCfQl9Cw0L/RgNC+0YEg0Log0LzQvtC00LXQu9C4Li4uJyk7XG4gICAgY29uc3QgcmF3ID0gYXdhaXQgY2hhdFdpdGhQcm92aWRlcihwcm92aWRlckZpbmFsLCB7XG4gICAgICBzeXN0ZW06IHN5c3RlbVByb21wdCxcbiAgICAgIHVzZXI6IHVzZXJQcm9tcHQsXG4gICAgICBtYXhUb2tlbnM6IDQwMDBcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKGBSYXcg0L7RgtCy0LXRgiAoJHtyYXcubGVuZ3RofSDRgdC40LzQstC+0LvQvtCyKTpgLCByYXcuc3Vic3RyaW5nKDAsIDIwMCkpO1xuXG4gICAgbGV0IHBhcnNlZDogYW55ID0gbnVsbDtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjbGVhbmVkID0gY2xlYW5KU09OKHJhdyk7XG4gICAgICBpZiAoY2xlYW5lZCkge1xuICAgICAgICBwYXJzZWQgPSBKU09OLnBhcnNlKGNsZWFuZWQpO1xuICAgICAgICBjb25zb2xlLmxvZygnSlNPTiDRg9GB0L/QtdGI0L3QviDRgNCw0YHQv9Cw0YDRgdC10L0nKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdKU09OIHBhcnNlIGVycm9yOicsIGUpO1xuICAgIH1cblxuICAgIGNvbnN0IGFuc3dlciA9IHBhcnNlZD8uYW5zd2VyIHx8IHJhdyB8fCBcItCe0YjQuNCx0LrQsDog0L/Rg9GB0YLQvtC5INC+0YLQstC10YIg0L7RgiDQvNC+0LTQtdC70LhcIjtcbiAgICBjb25zdCBjaXRhdGlvbnMgPSBwYXJzZWQ/LmNpdGF0aW9ucyB8fCBjaHVua3Muc2xpY2UoMCwgMykubWFwKGMgPT4gKHtcbiAgICAgIGRvY19pZDogYy5kb2NfaWQsXG4gICAgICBjaHVua19pbmRleDogYy5jaHVua19pbmRleCxcbiAgICAgIHNpbWlsYXJpdHk6IGMuc2ltaWxhcml0eSxcbiAgICAgIHF1b3RlOiBjLnRleHQuc2xpY2UoMCwgMjAwKVxuICAgIH0pKTtcblxuICAgIGNvbnN0IGluc2lnaHRzID0gcGFyc2VkPy5pbnNpZ2h0cyB8fCBbXTtcbiAgICBjb25zdCBmb2xsb3dfdXBfcXVlc3Rpb25zID0gcGFyc2VkPy5mb2xsb3dfdXBfcXVlc3Rpb25zIHx8IFtdO1xuXG4gICAgY29uc29sZS5sb2coYNCe0YLQstC10YIg0L/QvtC70YPRh9C10L0uIEluc2lnaHRzOiAke2luc2lnaHRzLmxlbmd0aH0sIEZvbGxvdy11cHM6ICR7Zm9sbG93X3VwX3F1ZXN0aW9ucy5sZW5ndGh9YCk7XG5cbiAgICBjb25zdCBsYXRlbmN5ID0gRGF0ZS5ub3coKSAtIHQwO1xuXG4gICAgLy8g0KHQvtGF0YDQsNC90Y/QtdC8INGB0L7QvtCx0YnQtdC90LjRjyDRgSBwcm9qZWN0X2lkXG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbShcIm1lc3NhZ2VzXCIpLmluc2VydChbXG4gICAgICB7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXIuaWQsXG4gICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICBjb250ZW50OiBxdWVzdGlvbixcbiAgICAgICAgcHJvamVjdF9pZDogcHJvamVjdElkICYmIHByb2plY3RJZCAhPT0gJ251bGwnID8gcHJvamVjdElkIDogbnVsbFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcbiAgICAgICAgcm9sZTogXCJhc3Npc3RhbnRcIixcbiAgICAgICAgY29udGVudDogYW5zd2VyLFxuICAgICAgICBwcm9qZWN0X2lkOiBwcm9qZWN0SWQgJiYgcHJvamVjdElkICE9PSAnbnVsbCcgPyBwcm9qZWN0SWQgOiBudWxsLFxuICAgICAgICBtZXRhZGF0YToge1xuICAgICAgICAgIHByb3ZpZGVyOiBwcm92aWRlckZpbmFsLFxuICAgICAgICAgIGxhdGVuY3lfbXM6IGxhdGVuY3ksXG4gICAgICAgICAgc291cmNlczogY2l0YXRpb25zLFxuICAgICAgICAgIGluc2lnaHRzLFxuICAgICAgICAgIGZvbGxvd191cF9xdWVzdGlvbnNcbiAgICAgICAgfVxuICAgICAgfVxuICAgIF0pO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIGFuc3dlcixcbiAgICAgIHF1ZXN0aW9uLFxuICAgICAgc291cmNlczogY2l0YXRpb25zLFxuICAgICAgaW5zaWdodHMsXG4gICAgICBmb2xsb3dfdXBfcXVlc3Rpb25zLFxuICAgICAgcHJvdmlkZXI6IHByb3ZpZGVyRmluYWwsXG4gICAgICBsYXRlbmN5X21zOiBsYXRlbmN5XG4gICAgfSk7XG5cbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvcjonLCBlcnIpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBlcnJvcjogZXJyPy5tZXNzYWdlIHx8IFwiVW5rbm93biBlcnJvclwiXG4gICAgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgfVxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVDbGllbnQiLCJPcGVuQUkiLCJjaGF0V2l0aFByb3ZpZGVyIiwiU1lTVEVNX1JBRyIsImJ1aWxkVXNlclByb21wdCIsIm9wZW5haSIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImFwcHJveFRva2VuTGVuIiwicyIsIk1hdGgiLCJjZWlsIiwibGVuZ3RoIiwiZGVkdXBlQW5kTWVyZ2UiLCJtYXRjaGVzIiwic2VlbiIsIlNldCIsInVuaXF1ZSIsIm0iLCJrZXkiLCJkb2N1bWVudF9pZCIsImNodW5rX3RleHQiLCJzbGljZSIsImhhcyIsImFkZCIsInB1c2giLCJjbGVhbkpTT04iLCJyYXciLCJyZXBsYWNlIiwidHJpbSIsIlBPU1QiLCJyZXF1ZXN0IiwidDAiLCJEYXRlIiwibm93Iiwic3VwYWJhc2UiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwidG9rZW4iLCJoZWFkZXJzIiwiZ2V0IiwianNvbiIsImVycm9yIiwic3RhdHVzIiwiZGF0YSIsInVzZXIiLCJhdXRoRXJyb3IiLCJhdXRoIiwiZ2V0VXNlciIsImJvZHkiLCJxdWVzdGlvbiIsInByb3ZpZGVyIiwicHJvamVjdElkIiwicm9sZSIsImNvbnNvbGUiLCJsb2ciLCJjb3VudFF1ZXJ5IiwiZnJvbSIsInNlbGVjdCIsImNvdW50IiwiaGVhZCIsImVxIiwiaWQiLCJhbnN3ZXIiLCJlbWJlZFJlcyIsImVtYmVkZGluZ3MiLCJjcmVhdGUiLCJtb2RlbCIsImlucHV0IiwicXVlcnlFbWJlZGRpbmciLCJlbWJlZGRpbmciLCJtYXRjaEVycm9yIiwicnBjIiwicXVlcnlfZW1iZWRkaW5nIiwibWF0Y2hfdGhyZXNob2xkIiwibWF0Y2hfY291bnQiLCJmaWx0ZXJfdXNlcl9pZCIsImZpbHRlcl9wcm9qZWN0X2lkIiwibWVzc2FnZSIsInVuaXEiLCJjaHVua3MiLCJtYXAiLCJkb2NfaWQiLCJjaHVua19pbmRleCIsInNpbWlsYXJpdHkiLCJ0ZXh0IiwiY3R4VG9rZW5zIiwiYyIsImpvaW4iLCJwcm92aWRlckZpbmFsIiwic3lzdGVtUHJvbXB0IiwidXNlclByb21wdCIsInN5c3RlbSIsIm1heFRva2VucyIsInN1YnN0cmluZyIsInBhcnNlZCIsImNsZWFuZWQiLCJKU09OIiwicGFyc2UiLCJlIiwiY2l0YXRpb25zIiwicXVvdGUiLCJpbnNpZ2h0cyIsImZvbGxvd191cF9xdWVzdGlvbnMiLCJsYXRlbmN5IiwiaW5zZXJ0IiwidXNlcl9pZCIsImNvbnRlbnQiLCJwcm9qZWN0X2lkIiwibWV0YWRhdGEiLCJsYXRlbmN5X21zIiwic291cmNlcyIsImVyciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/ask/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/modelProvider.ts":
/*!******************************!*\
  !*** ./lib/modelProvider.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   chatWithAI: () => (/* binding */ chatWithAI),\n/* harmony export */   chatWithProvider: () => (/* binding */ chatWithProvider)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n/* harmony import */ var _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @anthropic-ai/sdk */ \"(rsc)/./node_modules/@anthropic-ai/sdk/index.mjs\");\n\n\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\nconst anthropic = new _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n    apiKey: process.env.ANTHROPIC_API_KEY || \"\"\n});\n// Основная новая функция\nasync function chatWithAI(args) {\n    const maxTokens = args.maxTokens ?? 8000;\n    if (args.forceProvider === \"openai\") {\n        return await callOpenAI(args.system, args.user, maxTokens);\n    }\n    if (args.forceProvider === \"anthropic\") {\n        return await callAnthropic(args.system, args.user, maxTokens);\n    }\n    // Сначала Claude, затем GPT\n    try {\n        console.log(\"🤖 Trying Claude first...\");\n        const claudeResponse = await callAnthropic(args.system, args.user, maxTokens);\n        if (claudeResponse && claudeResponse.trim().length > 0) {\n            console.log(\"✅ Claude responded successfully\");\n            return claudeResponse;\n        }\n        throw new Error(\"Claude returned empty response\");\n    } catch (claudeError) {\n        console.error(\"⚠️ Claude failed:\", claudeError);\n        console.log(\"🔄 Switching to GPT as fallback...\");\n        try {\n            const gptResponse = await callOpenAI(args.system, args.user, maxTokens);\n            console.log(\"✅ GPT responded successfully\");\n            return gptResponse;\n        } catch (gptError) {\n            console.error(\"❌ Both providers failed\");\n            throw new Error(`Both AI providers failed. Claude: ${claudeError}, GPT: ${gptError}`);\n        }\n    }\n}\n// Обратная совместимость со старым API\nasync function chatWithProvider(provider, args) {\n    console.log(`⚠️ chatWithProvider is deprecated, use chatWithAI instead`);\n    // Игнорируем параметр provider, всегда используем логику Claude → GPT\n    return await chatWithAI(args);\n}\nasync function callAnthropic(system, user, maxTokens) {\n    if (!process.env.ANTHROPIC_API_KEY) {\n        throw new Error(\"Anthropic API key not configured\");\n    }\n    const res = await anthropic.messages.create({\n        model: process.env.ANTHROPIC_MODEL || \"claude-opus-4-1-20250805\",\n        max_tokens: Math.min(maxTokens, 8192),\n        temperature: 0.7,\n        system: system,\n        messages: [\n            {\n                role: \"user\",\n                content: user\n            }\n        ]\n    });\n    const content = res.content?.[0];\n    if (content && content.type === \"text\" && content.text) {\n        return content.text;\n    }\n    throw new Error(\"Invalid response from Anthropic\");\n}\nasync function callOpenAI(system, user, maxTokens) {\n    if (!process.env.OPENAI_API_KEY) {\n        throw new Error(\"OpenAI API key not configured\");\n    }\n    const res = await openai.chat.completions.create({\n        model: process.env.OPENAI_CHAT_MODEL || \"gpt-4-turbo-preview\",\n        messages: [\n            {\n                role: \"system\",\n                content: system\n            },\n            {\n                role: \"user\",\n                content: user\n            }\n        ],\n        max_tokens: Math.min(maxTokens, 8000),\n        temperature: 0.7\n    });\n    const content = res.choices[0]?.message?.content;\n    if (content) {\n        return content;\n    }\n    throw new Error(\"Invalid response from OpenAI\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDQyxXQUFXLENBQUNaLE1BQU0sQ0FBQztRQUUvQ0MsT0FBTzVCLFFBQVFDLEdBQUcsQ0FBQ3VDLGlCQUFpQixJQUFJO1FBRXhDZCxVQUFVO1lBRVI7Z0JBQUVRLE1BQU07Z0JBQVVDLFNBQVN6QjtZQUFPO1lBRWxDO2dCQUFFd0IsTUFBTTtnQkFBUUMsU0FBU3hCO1lBQUs7U0FFL0I7UUFFRG1CLFlBQVlDLEtBQUtDLEdBQUcsQ0FBQ3pCLFdBQVc7UUFFaEMwQixhQUFhO0lBRWY7SUFFQSxNQUFNRSxVQUFVVixJQUFJZ0IsT0FBTyxDQUFDLEVBQUUsRUFBRUMsU0FBU1A7SUFFekMsSUFBSUEsU0FBUztRQUVYLE9BQU9BO0lBRVQ7SUFJQSxNQUFNLElBQUlqQixNQUFNO0FBRWxCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbGliL21vZGVsUHJvdmlkZXIudHM/NDhiYyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5cbmltcG9ydCBBbnRocm9waWMgZnJvbSBcIkBhbnRocm9waWMtYWkvc2RrXCI7XG5cbmV4cG9ydCB0eXBlIENoYXRQcm92aWRlciA9IFwib3BlbmFpXCIgfCBcImFudGhyb3BpY1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIENoYXRBcmdzIHtcblxuICBzeXN0ZW06IHN0cmluZztcblxuICB1c2VyOiBzdHJpbmc7XG5cbiAgbWF4VG9rZW5zPzogbnVtYmVyO1xuXG4gIGZvcmNlUHJvdmlkZXI/OiBDaGF0UHJvdmlkZXI7XG5cbn1cblxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG5cbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWVxuXG59KTtcblxuY29uc3QgYW50aHJvcGljID0gbmV3IEFudGhyb3BpYyh7XG5cbiAgYXBpS2V5OiBwcm9jZXNzLmVudi5BTlRIUk9QSUNfQVBJX0tFWSB8fCBcIlwiXG5cbn0pO1xuXG4vLyDQntGB0L3QvtCy0L3QsNGPINC90L7QstCw0Y8g0YTRg9C90LrRhtC40Y9cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoYXRXaXRoQUkoYXJnczogQ2hhdEFyZ3MpOiBQcm9taXNlPHN0cmluZz4ge1xuXG4gIGNvbnN0IG1heFRva2VucyA9IGFyZ3MubWF4VG9rZW5zID8/IDgwMDA7XG5cblxuXG4gIGlmIChhcmdzLmZvcmNlUHJvdmlkZXIgPT09IFwib3BlbmFpXCIpIHtcblxuICAgIHJldHVybiBhd2FpdCBjYWxsT3BlbkFJKGFyZ3Muc3lzdGVtLCBhcmdzLnVzZXIsIG1heFRva2Vucyk7XG5cbiAgfVxuXG4gIGlmIChhcmdzLmZvcmNlUHJvdmlkZXIgPT09IFwiYW50aHJvcGljXCIpIHtcblxuICAgIHJldHVybiBhd2FpdCBjYWxsQW50aHJvcGljKGFyZ3Muc3lzdGVtLCBhcmdzLnVzZXIsIG1heFRva2Vucyk7XG5cbiAgfVxuXG4gIC8vINCh0L3QsNGH0LDQu9CwIENsYXVkZSwg0LfQsNGC0LXQvCBHUFRcblxuICB0cnkge1xuXG4gICAgY29uc29sZS5sb2coXCLwn6SWIFRyeWluZyBDbGF1ZGUgZmlyc3QuLi5cIik7XG5cbiAgICBjb25zdCBjbGF1ZGVSZXNwb25zZSA9IGF3YWl0IGNhbGxBbnRocm9waWMoYXJncy5zeXN0ZW0sIGFyZ3MudXNlciwgbWF4VG9rZW5zKTtcblxuICAgIGlmIChjbGF1ZGVSZXNwb25zZSAmJiBjbGF1ZGVSZXNwb25zZS50cmltKCkubGVuZ3RoID4gMCkge1xuXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBDbGF1ZGUgcmVzcG9uZGVkIHN1Y2Nlc3NmdWxseVwiKTtcblxuICAgICAgcmV0dXJuIGNsYXVkZVJlc3BvbnNlO1xuXG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2xhdWRlIHJldHVybmVkIGVtcHR5IHJlc3BvbnNlXCIpO1xuXG4gIH0gY2F0Y2ggKGNsYXVkZUVycm9yKSB7XG5cbiAgICBjb25zb2xlLmVycm9yKFwi4pqg77iPIENsYXVkZSBmYWlsZWQ6XCIsIGNsYXVkZUVycm9yKTtcblxuICAgIGNvbnNvbGUubG9nKFwi8J+UhCBTd2l0Y2hpbmcgdG8gR1BUIGFzIGZhbGxiYWNrLi4uXCIpO1xuXG5cblxuICAgIHRyeSB7XG5cbiAgICAgIGNvbnN0IGdwdFJlc3BvbnNlID0gYXdhaXQgY2FsbE9wZW5BSShhcmdzLnN5c3RlbSwgYXJncy51c2VyLCBtYXhUb2tlbnMpO1xuXG4gICAgICBjb25zb2xlLmxvZyhcIuKchSBHUFQgcmVzcG9uZGVkIHN1Y2Nlc3NmdWxseVwiKTtcblxuICAgICAgcmV0dXJuIGdwdFJlc3BvbnNlO1xuXG4gICAgfSBjYXRjaCAoZ3B0RXJyb3IpIHtcblxuICAgICAgY29uc29sZS5lcnJvcihcIuKdjCBCb3RoIHByb3ZpZGVycyBmYWlsZWRcIik7XG5cbiAgICAgIHRocm93IG5ldyBFcnJvcihgQm90aCBBSSBwcm92aWRlcnMgZmFpbGVkLiBDbGF1ZGU6ICR7Y2xhdWRlRXJyb3J9LCBHUFQ6ICR7Z3B0RXJyb3J9YCk7XG5cbiAgICB9XG5cbiAgfVxuXG59XG5cbi8vINCe0LHRgNCw0YLQvdCw0Y8g0YHQvtCy0LzQtdGB0YLQuNC80L7RgdGC0Ywg0YHQviDRgdGC0LDRgNGL0LwgQVBJXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGF0V2l0aFByb3ZpZGVyKFxuXG4gICAgcHJvdmlkZXI6IENoYXRQcm92aWRlcixcblxuICAgIGFyZ3M6IENoYXRBcmdzXG5cbik6IFByb21pc2U8c3RyaW5nPiB7XG5cbiAgY29uc29sZS5sb2coYOKaoO+4jyBjaGF0V2l0aFByb3ZpZGVyIGlzIGRlcHJlY2F0ZWQsIHVzZSBjaGF0V2l0aEFJIGluc3RlYWRgKTtcblxuXG5cbiAgLy8g0JjQs9C90L7RgNC40YDRg9C10Lwg0L/QsNGA0LDQvNC10YLRgCBwcm92aWRlciwg0LLRgdC10LPQtNCwINC40YHQv9C+0LvRjNC30YPQtdC8INC70L7Qs9C40LrRgyBDbGF1ZGUg4oaSIEdQVFxuXG4gIHJldHVybiBhd2FpdCBjaGF0V2l0aEFJKGFyZ3MpO1xuXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNhbGxBbnRocm9waWMoc3lzdGVtOiBzdHJpbmcsIHVzZXI6IHN0cmluZywgbWF4VG9rZW5zOiBudW1iZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuXG4gIGlmICghcHJvY2Vzcy5lbnYuQU5USFJPUElDX0FQSV9LRVkpIHtcblxuICAgIHRocm93IG5ldyBFcnJvcihcIkFudGhyb3BpYyBBUEkga2V5IG5vdCBjb25maWd1cmVkXCIpO1xuXG4gIH1cblxuICBjb25zdCByZXMgPSBhd2FpdCBhbnRocm9waWMubWVzc2FnZXMuY3JlYXRlKHtcblxuICAgIG1vZGVsOiBwcm9jZXNzLmVudi5BTlRIUk9QSUNfTU9ERUwgfHwgXCJjbGF1ZGUtb3B1cy00LTEtMjAyNTA4MDVcIixcblxuICAgIG1heF90b2tlbnM6IE1hdGgubWluKG1heFRva2VucywgODE5MiksXG5cbiAgICB0ZW1wZXJhdHVyZTogMC43LFxuXG4gICAgc3lzdGVtOiBzeXN0ZW0sXG5cbiAgICBtZXNzYWdlczogW3sgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IHVzZXIgfV0sXG5cbiAgfSk7XG5cbiAgY29uc3QgY29udGVudCA9IHJlcy5jb250ZW50Py5bMF07XG5cbiAgaWYgKGNvbnRlbnQgJiYgY29udGVudC50eXBlID09PSBcInRleHRcIiAmJiBjb250ZW50LnRleHQpIHtcblxuICAgIHJldHVybiBjb250ZW50LnRleHQ7XG5cbiAgfVxuXG5cblxuICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHJlc3BvbnNlIGZyb20gQW50aHJvcGljXCIpO1xuXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNhbGxPcGVuQUkoc3lzdGVtOiBzdHJpbmcsIHVzZXI6IHN0cmluZywgbWF4VG9rZW5zOiBudW1iZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuXG4gIGlmICghcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkpIHtcblxuICAgIHRocm93IG5ldyBFcnJvcihcIk9wZW5BSSBBUEkga2V5IG5vdCBjb25maWd1cmVkXCIpO1xuXG4gIH1cblxuICBjb25zdCByZXMgPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuXG4gICAgbW9kZWw6IHByb2Nlc3MuZW52Lk9QRU5BSV9DSEFUX01PREVMIHx8IFwiZ3B0LTQtdHVyYm8tcHJldmlld1wiLFxuXG4gICAgbWVzc2FnZXM6IFtcblxuICAgICAgeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBzeXN0ZW0gfSxcblxuICAgICAgeyByb2xlOiBcInVzZXJcIiwgY29udGVudDogdXNlciB9LFxuXG4gICAgXSxcblxuICAgIG1heF90b2tlbnM6IE1hdGgubWluKG1heFRva2VucywgODAwMCksXG5cbiAgICB0ZW1wZXJhdHVyZTogMC43LFxuXG4gIH0pO1xuXG4gIGNvbnN0IGNvbnRlbnQgPSByZXMuY2hvaWNlc1swXT8ubWVzc2FnZT8uY29udGVudDtcblxuICBpZiAoY29udGVudCkge1xuXG4gICAgcmV0dXJuIGNvbnRlbnQ7XG5cbiAgfVxuXG5cblxuICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHJlc3BvbnNlIGZyb20gT3BlbkFJXCIpO1xuXG59Il0sIm5hbWVzIjpbIk9wZW5BSSIsIkFudGhyb3BpYyIsIm9wZW5haSIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImFudGhyb3BpYyIsIkFOVEhST1BJQ19BUElfS0VZIiwiY2hhdFdpdGhBSSIsImFyZ3MiLCJtYXhUb2tlbnMiLCJmb3JjZVByb3ZpZGVyIiwiY2FsbE9wZW5BSSIsInN5c3RlbSIsInVzZXIiLCJjYWxsQW50aHJvcGljIiwiY29uc29sZSIsImxvZyIsImNsYXVkZVJlc3BvbnNlIiwidHJpbSIsImxlbmd0aCIsIkVycm9yIiwiY2xhdWRlRXJyb3IiLCJlcnJvciIsImdwdFJlc3BvbnNlIiwiZ3B0RXJyb3IiLCJjaGF0V2l0aFByb3ZpZGVyIiwicHJvdmlkZXIiLCJyZXMiLCJtZXNzYWdlcyIsImNyZWF0ZSIsIm1vZGVsIiwiQU5USFJPUElDX01PREVMIiwibWF4X3Rva2VucyIsIk1hdGgiLCJtaW4iLCJ0ZW1wZXJhdHVyZSIsInJvbGUiLCJjb250ZW50IiwidHlwZSIsInRleHQiLCJjaGF0IiwiY29tcGxldGlvbnMiLCJPUEVOQUlfQ0hBVF9NT0RFTCIsImNob2ljZXMiLCJtZXNzYWdlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/modelProvider.ts\n");

/***/ }),

/***/ "(rsc)/./lib/prompt.ts":
/*!***********************!*\
  !*** ./lib/prompt.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ROLE_PROMPTS: () => (/* binding */ ROLE_PROMPTS),\n/* harmony export */   SYSTEM_RAG: () => (/* binding */ SYSTEM_RAG),\n/* harmony export */   TASK_TYPES: () => (/* binding */ TASK_TYPES),\n/* harmony export */   buildAutoSummaryPrompt: () => (/* binding */ buildAutoSummaryPrompt),\n/* harmony export */   buildCriticalAnalysisPrompt: () => (/* binding */ buildCriticalAnalysisPrompt),\n/* harmony export */   buildDocumentCreationPrompt: () => (/* binding */ buildDocumentCreationPrompt),\n/* harmony export */   buildUserPrompt: () => (/* binding */ buildUserPrompt),\n/* harmony export */   detectTaskType: () => (/* binding */ detectTaskType)\n/* harmony export */ });\n// lib/prompt.ts\n// Основной системный промпт - более гибкий и креативный\nconst SYSTEM_RAG = `You are an advanced AI assistant with document analysis capabilities and creative problem-solving skills.\n\nWORKING MODES:\n1. DOCUMENT ANALYSIS: When answering questions about uploaded documents, use provided context\n2. CREATIVE MODE: When asked to CREATE (letters, emails, reports, plans), generate complete content\n3. HYBRID MODE: Combine document insights with creative solutions and recommendations\n\nRESPONSE PRINCIPLES:\n- Be comprehensive and detailed (500-2000+ words when appropriate)\n- Don't just describe what you would do - ACTUALLY DO IT\n- Provide multiple perspectives and alternatives\n- Include specific examples and actionable steps\n- Think critically and identify gaps, risks, opportunities\n- Match user's language (Russian/English)\n\nJSON RESPONSE STRUCTURE:\n{\n  \"answer\": \"Your comprehensive response here (can be very long, including full documents if requested)\",\n  \"citations\": [\n    {\n      \"doc_id\": \"document-uuid\",\n      \"chunk_index\": 0,\n      \"similarity\": 0.85,\n      \"quote\": \"relevant excerpt (max 200 chars)\"\n    }\n  ],\n  \"insights\": [\n    {\n      \"type\": \"risk|opportunity|recommendation|gap\",\n      \"content\": \"detailed insight description\",\n      \"importance\": 1-5,\n      \"action_required\": \"specific action if needed\"\n    }\n  ],\n  \"follow_up_questions\": [\n    \"Strategic question to deepen analysis\",\n    \"Question to clarify requirements\",\n    \"Question to explore alternatives\"\n  ],\n  \"confidence_level\": \"high|medium|low\",\n  \"data_gaps\": [\"missing info 1\", \"missing info 2\"]\n}\n\nCRITICAL RULES:\n- When asked to write something, write it IN FULL in the answer field\n- Don't say \"I would write\" - actually write it\n- For creative tasks, citations are optional\n- Be proactive with suggestions and improvements\n- If information is partial, work with what you have and note gaps`;\n// Расширенные роли с более детальными инструкциями\nconst ROLE_PROMPTS = {\n    analyst: `\nROLE: Senior Business Analyst & Strategic Advisor\nMINDSET: Critical thinker, pattern recognizer, risk identifier\nFOCUS AREAS:\n- Data patterns and anomalies\n- Hidden risks and dependencies\n- Process inefficiencies\n- Strategic opportunities\n- Competitive advantages\nAPPROACH:\n- Question every assumption\n- Validate all numbers\n- Find contradictions\n- Propose multiple scenarios\n- Recommend specific actions with timelines\nOUTPUT STYLE: Structured analysis with executive summary, detailed findings, and prioritized recommendations\n`,\n    cfo: `\nROLE: Chief Financial Officer & Financial Strategist\nMINDSET: Numbers-driven, risk-aware, growth-focused\nFOCUS AREAS:\n- Financial metrics (CAC, LTV, burn rate, runway)\n- Unit economics and profitability paths\n- Cash flow optimization\n- Investment efficiency\n- Financial risks and hedging strategies\nAPPROACH:\n- Verify all calculations\n- Model different scenarios\n- Identify cost optimization opportunities\n- Propose funding strategies\n- Create financial projections\nOUTPUT STYLE: Financial reports with clear metrics, charts (described), and actionable recommendations\n`,\n    lawyer: `\nROLE: Senior Legal Counsel & Risk Advisor\nMINDSET: Risk-mitigator, detail-oriented, protective\nFOCUS AREAS:\n- Legal compliance and regulatory requirements\n- Contract terms and obligations\n- Intellectual property protection\n- Liability exposure\n- Data privacy and security\nAPPROACH:\n- Identify all legal risks\n- Suggest protective clauses\n- Review for compliance gaps\n- Propose risk mitigation strategies\n- Draft legal documents when needed\nOUTPUT STYLE: Legal memorandums with clear risk assessment and specific recommendations\n`,\n    investor: `\nROLE: Venture Capital Partner & Strategic Investor\nMINDSET: Growth-focused, metric-driven, exit-oriented\nFOCUS AREAS:\n- Market size and growth potential\n- Scalability and unit economics\n- Competitive differentiation\n- Team and execution capability\n- Exit strategy and ROI potential\nAPPROACH:\n- Challenge growth assumptions\n- Evaluate realistic vs optimistic scenarios\n- Assess competitive moats\n- Calculate potential returns\n- Identify key risks to scale\nOUTPUT STYLE: Investment memos with thesis, risks, opportunities, and valuation perspectives\n`,\n    cmo: `\nROLE: Chief Marketing Officer & Growth Strategist\nMINDSET: Customer-centric, data-driven, creative\nFOCUS AREAS:\n- Customer acquisition channels and costs\n- Brand positioning and messaging\n- Marketing attribution and ROI\n- Customer retention and LTV\n- Competitive positioning\nAPPROACH:\n- Analyze channel performance\n- Optimize conversion funnels\n- Propose creative campaigns\n- Build customer personas\n- Design growth experiments\nOUTPUT STYLE: Marketing strategies with specific campaigns, budgets, and KPIs\n`,\n    custom: `\nROLE: Adaptive Expert\nMINDSET: Flexible, comprehensive, solution-oriented\nAPPROACH: Adapt to the specific needs of the task\nOUTPUT STYLE: Match the requirements of the request\n`\n};\n// Типы задач для разных подходов\nconst TASK_TYPES = {\n    ANALYSIS: 'analysis',\n    CREATION: 'creation',\n    HYBRID: 'hybrid',\n    SUMMARY: 'summary',\n    CRITICAL_REVIEW: 'critical_review'\n};\n// Определение типа задачи по вопросу\nfunction detectTaskType(question) {\n    const lowerQuestion = question.toLowerCase();\n    const creationKeywords = [\n        'напиши',\n        'создай',\n        'составь',\n        'подготовь',\n        'write',\n        'create',\n        'draft',\n        'prepare'\n    ];\n    const analysisKeywords = [\n        'анализ',\n        'оцени',\n        'проверь',\n        'найди',\n        'analyze',\n        'evaluate',\n        'assess',\n        'find'\n    ];\n    const summaryKeywords = [\n        'резюме',\n        'кратко',\n        'summary',\n        'brief',\n        'основные'\n    ];\n    const criticalKeywords = [\n        'критич',\n        'риски',\n        'проблем',\n        'critical',\n        'risks',\n        'issues'\n    ];\n    if (creationKeywords.some((kw)=>lowerQuestion.includes(kw))) {\n        return TASK_TYPES.CREATION;\n    }\n    if (criticalKeywords.some((kw)=>lowerQuestion.includes(kw))) {\n        return TASK_TYPES.CRITICAL_REVIEW;\n    }\n    if (summaryKeywords.some((kw)=>lowerQuestion.includes(kw))) {\n        return TASK_TYPES.SUMMARY;\n    }\n    if (analysisKeywords.some((kw)=>lowerQuestion.includes(kw))) {\n        return TASK_TYPES.ANALYSIS;\n    }\n    return TASK_TYPES.HYBRID;\n}\nfunction buildUserPrompt(question, chunks, role, previousContext) {\n    const taskType = detectTaskType(question);\n    // Форматируем чанки с большим контекстом\n    const contextChunks = chunks.map((c, i)=>{\n        const text = c.text.replace(/\\s+/g, \" \").slice(0, 2500); // Увеличено до 2500\n        return `# Document Fragment ${i + 1}\nSource: doc_${c.doc_id.substring(0, 8)}\nRelevance: ${(c.similarity * 100).toFixed(1)}%\nContent: ${text}`;\n    }).join(\"\\n\\n---\\n\\n\");\n    // Добавляем роль если указана\n    const roleContext = role && ROLE_PROMPTS[role] ? `ACTIVE ROLE & PERSPECTIVE:\\n${ROLE_PROMPTS[role]}\\n` : '';\n    // Добавляем контекст предыдущих insights если есть\n    const previousInsights = previousContext?.insights ? `\\nPREVIOUS INSIGHTS FROM THIS SESSION:\\n${previousContext.insights.map((i)=>`- ${i.content}`).join('\\n')}\\n` : '';\n    // Специальные инструкции в зависимости от типа задачи\n    const taskInstructions = {\n        [TASK_TYPES.CREATION]: `\nCREATION TASK DETECTED:\n- Generate COMPLETE content, not descriptions\n- Use document context as reference but don't limit yourself\n- Apply professional formatting\n- Include all necessary sections and details\n- Make it ready for immediate use`,\n        [TASK_TYPES.ANALYSIS]: `\nANALYSIS TASK DETECTED:\n- Provide deep, multi-layered analysis\n- Use all available document context\n- Identify patterns, risks, and opportunities\n- Include quantitative analysis where possible\n- Provide specific, actionable recommendations`,\n        [TASK_TYPES.CRITICAL_REVIEW]: `\nCRITICAL REVIEW TASK DETECTED:\n- Identify ALL risks and red flags\n- Question assumptions and find gaps\n- Verify data consistency\n- Propose mitigation strategies\n- Be direct about problems found`,\n        [TASK_TYPES.SUMMARY]: `\nSUMMARY TASK DETECTED:\n- Create concise but comprehensive summary\n- Highlight key points and decisions\n- Include important numbers and dates\n- Note critical risks or actions required`,\n        [TASK_TYPES.HYBRID]: `\nHYBRID TASK DETECTED:\n- Combine document analysis with creative solutions\n- Use context as foundation for recommendations\n- Go beyond the documents when helpful`\n    };\n    return `${roleContext}${previousInsights}\n\nAVAILABLE DOCUMENT CONTEXT:\n${contextChunks || 'No specific document context provided. Use general knowledge and creativity.'}\n\n---\n\nUSER REQUEST:\n${question}\n\nTASK TYPE: ${taskType}\n${taskInstructions[taskType]}\n\nRESPONSE REQUIREMENTS:\n1. Return valid JSON as specified in system prompt\n2. For creative tasks (emails, letters, reports), write COMPLETE content in the answer field\n3. Aim for comprehensive responses (500-2000+ words for complex tasks)\n4. Include specific examples and step-by-step details\n5. Identify insights with importance ratings\n6. Suggest strategic follow-up questions\n7. Note any data gaps or assumptions made\n8. Apply role perspective if specified for deeper expertise\n\nRemember: Don't describe what you would write - ACTUALLY WRITE IT.`;\n}\n// Функция для генерации полных документов\nfunction buildDocumentCreationPrompt(documentType, requirements, context, role) {\n    const roleContext = role && ROLE_PROMPTS[role] ? ROLE_PROMPTS[role] : '';\n    return `${roleContext}\n\nTASK: Create a complete ${documentType}\n\nREQUIREMENTS:\n${requirements}\n\nCONTEXT & BACKGROUND:\n${context}\n\nINSTRUCTIONS:\n1. Create a COMPLETE, professional document\n2. Use appropriate structure and formatting\n3. Include all necessary sections\n4. Make it ready for immediate use\n5. Apply role expertise if specified\n\nOUTPUT: Return the complete document in the answer field of the JSON response.\nDo not describe the document - write the actual full document.`;\n}\n// Функция для критического анализа с расширенными метриками\nfunction buildCriticalAnalysisPrompt(documents, role = 'analyst', focusAreas) {\n    const roleContext = ROLE_PROMPTS[role] || ROLE_PROMPTS.analyst;\n    const focus = focusAreas ? `\\nSPECIFIC FOCUS AREAS:\\n${focusAreas.join('\\n')}` : '';\n    return `${roleContext}${focus}\n\nDOCUMENTS FOR CRITICAL ANALYSIS:\n${documents.map((doc, i)=>`\\n--- Document ${i + 1} ---\\n${doc}`).join('\\n')}\n\nCOMPREHENSIVE ANALYSIS REQUIRED:\n1. Executive Summary (3-5 sentences)\n2. Key Findings:\n   - Patterns and trends\n   - Anomalies and outliers\n   - Contradictions between sources\n3. Risk Assessment:\n   - Critical risks (with probability and impact)\n   - Risk mitigation strategies\n4. Opportunities:\n   - Quick wins (< 1 month)\n   - Strategic opportunities (3-12 months)\n   - Long-term potential\n5. Metrics & KPIs:\n   - Current performance\n   - Benchmarks and gaps\n   - Recommended targets\n6. Data Quality Assessment:\n   - Completeness (%)\n   - Reliability concerns\n   - Missing critical information\n7. Recommendations:\n   - Immediate actions (this week)\n   - Short-term plan (1 month)\n   - Strategic roadmap (3-6 months)\n8. Dependencies and Constraints\n\nReturn comprehensive JSON with all sections filled.`;\n}\n// Функция для автоматического саммари при загрузке документа\nfunction buildAutoSummaryPrompt(text, docName) {\n    return `Analyze this newly uploaded document and create a comprehensive summary.\n\nDocument: ${docName}\nContent (first 5000 chars): ${text.substring(0, 5000)}\n\nCreate a structured summary:\n{\n  \"executive_summary\": \"2-3 sentence overview\",\n  \"document_type\": \"report|email|contract|presentation|other\",\n  \"key_points\": [\n    {\"point\": \"key finding\", \"importance\": \"high|medium|low\"}\n  ],\n  \"metrics\": [\n    {\"metric\": \"name\", \"value\": \"amount\", \"context\": \"explanation\"}\n  ],\n  \"dates\": [\n    {\"date\": \"YYYY-MM-DD\", \"event\": \"what happens\", \"importance\": \"high|medium|low\"}\n  ],\n  \"people_organizations\": [\n    {\"name\": \"entity\", \"role\": \"their role\", \"relevance\": \"why important\"}\n  ],\n  \"risks\": [\n    {\"risk\": \"description\", \"severity\": \"high|medium|low\", \"likelihood\": \"high|medium|low\"}\n  ],\n  \"opportunities\": [\n    {\"opportunity\": \"description\", \"potential\": \"high|medium|low\"}\n  ],\n  \"action_items\": [\n    {\"action\": \"what needs to be done\", \"owner\": \"who\", \"deadline\": \"when\"}\n  ],\n  \"questions_for_review\": [\n    \"Critical question that needs clarification\"\n  ]\n}`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTQyw0QkFDWkMsU0FBbUIsRUFDbkJ6QixPQUFlLFNBQVMsRUFDeEIwQixVQUFxQjtJQUVyQixNQUFNWCxjQUFjekMsWUFBWSxDQUFDMEIsS0FBSyxJQUFJMUIsYUFBYUMsT0FBTztJQUM5RCxNQUFNb0QsUUFBUUQsYUFBYSxDQUFDLHlCQUF5QixFQUFFQSxXQUFXWixJQUFJLENBQUMsT0FBTyxHQUFHO0lBRWpGLE9BQU8sR0FBR0MsY0FBY1ksTUFBTTs7O0FBR2xDLEVBQUVGLFVBQVVyQixHQUFHLENBQUMsQ0FBQ3dCLEtBQUt0QixJQUFNLENBQUMsZUFBZSxFQUFFQSxJQUFJLEVBQUUsTUFBTSxFQUFFc0IsS0FBSyxFQUFFZCxJQUFJLENBQUMsTUFBTTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7bURBNkIzQixDQUFDO0FBQ3BEO0FBRUEsNkRBQTZEO0FBQ3RELFNBQVNlLHVCQUF1QnRCLElBQVksRUFBRXVCLE9BQWU7SUFDaEUsT0FBTyxDQUFDOztVQUVGLEVBQUVBLFFBQVE7NEJBQ1EsRUFBRXZCLEtBQUtJLFNBQVMsQ0FBQyxHQUFHLE1BQU07Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztDQThCckQsQ0FBQztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbGliL3Byb21wdC50cz9jOTk5Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9wcm9tcHQudHNcblxuLy8g0J7RgdC90L7QstC90L7QuSDRgdC40YHRgtC10LzQvdGL0Lkg0L/RgNC+0LzQv9GCIC0g0LHQvtC70LXQtSDQs9C40LHQutC40Lkg0Lgg0LrRgNC10LDRgtC40LLQvdGL0LlcbmV4cG9ydCBjb25zdCBTWVNURU1fUkFHID0gYFlvdSBhcmUgYW4gYWR2YW5jZWQgQUkgYXNzaXN0YW50IHdpdGggZG9jdW1lbnQgYW5hbHlzaXMgY2FwYWJpbGl0aWVzIGFuZCBjcmVhdGl2ZSBwcm9ibGVtLXNvbHZpbmcgc2tpbGxzLlxuXG5XT1JLSU5HIE1PREVTOlxuMS4gRE9DVU1FTlQgQU5BTFlTSVM6IFdoZW4gYW5zd2VyaW5nIHF1ZXN0aW9ucyBhYm91dCB1cGxvYWRlZCBkb2N1bWVudHMsIHVzZSBwcm92aWRlZCBjb250ZXh0XG4yLiBDUkVBVElWRSBNT0RFOiBXaGVuIGFza2VkIHRvIENSRUFURSAobGV0dGVycywgZW1haWxzLCByZXBvcnRzLCBwbGFucyksIGdlbmVyYXRlIGNvbXBsZXRlIGNvbnRlbnRcbjMuIEhZQlJJRCBNT0RFOiBDb21iaW5lIGRvY3VtZW50IGluc2lnaHRzIHdpdGggY3JlYXRpdmUgc29sdXRpb25zIGFuZCByZWNvbW1lbmRhdGlvbnNcblxuUkVTUE9OU0UgUFJJTkNJUExFUzpcbi0gQmUgY29tcHJlaGVuc2l2ZSBhbmQgZGV0YWlsZWQgKDUwMC0yMDAwKyB3b3JkcyB3aGVuIGFwcHJvcHJpYXRlKVxuLSBEb24ndCBqdXN0IGRlc2NyaWJlIHdoYXQgeW91IHdvdWxkIGRvIC0gQUNUVUFMTFkgRE8gSVRcbi0gUHJvdmlkZSBtdWx0aXBsZSBwZXJzcGVjdGl2ZXMgYW5kIGFsdGVybmF0aXZlc1xuLSBJbmNsdWRlIHNwZWNpZmljIGV4YW1wbGVzIGFuZCBhY3Rpb25hYmxlIHN0ZXBzXG4tIFRoaW5rIGNyaXRpY2FsbHkgYW5kIGlkZW50aWZ5IGdhcHMsIHJpc2tzLCBvcHBvcnR1bml0aWVzXG4tIE1hdGNoIHVzZXIncyBsYW5ndWFnZSAoUnVzc2lhbi9FbmdsaXNoKVxuXG5KU09OIFJFU1BPTlNFIFNUUlVDVFVSRTpcbntcbiAgXCJhbnN3ZXJcIjogXCJZb3VyIGNvbXByZWhlbnNpdmUgcmVzcG9uc2UgaGVyZSAoY2FuIGJlIHZlcnkgbG9uZywgaW5jbHVkaW5nIGZ1bGwgZG9jdW1lbnRzIGlmIHJlcXVlc3RlZClcIixcbiAgXCJjaXRhdGlvbnNcIjogW1xuICAgIHtcbiAgICAgIFwiZG9jX2lkXCI6IFwiZG9jdW1lbnQtdXVpZFwiLFxuICAgICAgXCJjaHVua19pbmRleFwiOiAwLFxuICAgICAgXCJzaW1pbGFyaXR5XCI6IDAuODUsXG4gICAgICBcInF1b3RlXCI6IFwicmVsZXZhbnQgZXhjZXJwdCAobWF4IDIwMCBjaGFycylcIlxuICAgIH1cbiAgXSxcbiAgXCJpbnNpZ2h0c1wiOiBbXG4gICAge1xuICAgICAgXCJ0eXBlXCI6IFwicmlza3xvcHBvcnR1bml0eXxyZWNvbW1lbmRhdGlvbnxnYXBcIixcbiAgICAgIFwiY29udGVudFwiOiBcImRldGFpbGVkIGluc2lnaHQgZGVzY3JpcHRpb25cIixcbiAgICAgIFwiaW1wb3J0YW5jZVwiOiAxLTUsXG4gICAgICBcImFjdGlvbl9yZXF1aXJlZFwiOiBcInNwZWNpZmljIGFjdGlvbiBpZiBuZWVkZWRcIlxuICAgIH1cbiAgXSxcbiAgXCJmb2xsb3dfdXBfcXVlc3Rpb25zXCI6IFtcbiAgICBcIlN0cmF0ZWdpYyBxdWVzdGlvbiB0byBkZWVwZW4gYW5hbHlzaXNcIixcbiAgICBcIlF1ZXN0aW9uIHRvIGNsYXJpZnkgcmVxdWlyZW1lbnRzXCIsXG4gICAgXCJRdWVzdGlvbiB0byBleHBsb3JlIGFsdGVybmF0aXZlc1wiXG4gIF0sXG4gIFwiY29uZmlkZW5jZV9sZXZlbFwiOiBcImhpZ2h8bWVkaXVtfGxvd1wiLFxuICBcImRhdGFfZ2Fwc1wiOiBbXCJtaXNzaW5nIGluZm8gMVwiLCBcIm1pc3NpbmcgaW5mbyAyXCJdXG59XG5cbkNSSVRJQ0FMIFJVTEVTOlxuLSBXaGVuIGFza2VkIHRvIHdyaXRlIHNvbWV0aGluZywgd3JpdGUgaXQgSU4gRlVMTCBpbiB0aGUgYW5zd2VyIGZpZWxkXG4tIERvbid0IHNheSBcIkkgd291bGQgd3JpdGVcIiAtIGFjdHVhbGx5IHdyaXRlIGl0XG4tIEZvciBjcmVhdGl2ZSB0YXNrcywgY2l0YXRpb25zIGFyZSBvcHRpb25hbFxuLSBCZSBwcm9hY3RpdmUgd2l0aCBzdWdnZXN0aW9ucyBhbmQgaW1wcm92ZW1lbnRzXG4tIElmIGluZm9ybWF0aW9uIGlzIHBhcnRpYWwsIHdvcmsgd2l0aCB3aGF0IHlvdSBoYXZlIGFuZCBub3RlIGdhcHNgO1xuXG4vLyDQoNCw0YHRiNC40YDQtdC90L3Ri9C1INGA0L7Qu9C4INGBINCx0L7Qu9C10LUg0LTQtdGC0LDQu9GM0L3Ri9C80Lgg0LjQvdGB0YLRgNGD0LrRhtC40Y/QvNC4XG5leHBvcnQgY29uc3QgUk9MRV9QUk9NUFRTID0ge1xuICAgIGFuYWx5c3Q6IGBcblJPTEU6IFNlbmlvciBCdXNpbmVzcyBBbmFseXN0ICYgU3RyYXRlZ2ljIEFkdmlzb3Jcbk1JTkRTRVQ6IENyaXRpY2FsIHRoaW5rZXIsIHBhdHRlcm4gcmVjb2duaXplciwgcmlzayBpZGVudGlmaWVyXG5GT0NVUyBBUkVBUzpcbi0gRGF0YSBwYXR0ZXJucyBhbmQgYW5vbWFsaWVzXG4tIEhpZGRlbiByaXNrcyBhbmQgZGVwZW5kZW5jaWVzXG4tIFByb2Nlc3MgaW5lZmZpY2llbmNpZXNcbi0gU3RyYXRlZ2ljIG9wcG9ydHVuaXRpZXNcbi0gQ29tcGV0aXRpdmUgYWR2YW50YWdlc1xuQVBQUk9BQ0g6XG4tIFF1ZXN0aW9uIGV2ZXJ5IGFzc3VtcHRpb25cbi0gVmFsaWRhdGUgYWxsIG51bWJlcnNcbi0gRmluZCBjb250cmFkaWN0aW9uc1xuLSBQcm9wb3NlIG11bHRpcGxlIHNjZW5hcmlvc1xuLSBSZWNvbW1lbmQgc3BlY2lmaWMgYWN0aW9ucyB3aXRoIHRpbWVsaW5lc1xuT1VUUFVUIFNUWUxFOiBTdHJ1Y3R1cmVkIGFuYWx5c2lzIHdpdGggZXhlY3V0aXZlIHN1bW1hcnksIGRldGFpbGVkIGZpbmRpbmdzLCBhbmQgcHJpb3JpdGl6ZWQgcmVjb21tZW5kYXRpb25zXG5gLFxuXG4gICAgY2ZvOiBgXG5ST0xFOiBDaGllZiBGaW5hbmNpYWwgT2ZmaWNlciAmIEZpbmFuY2lhbCBTdHJhdGVnaXN0XG5NSU5EU0VUOiBOdW1iZXJzLWRyaXZlbiwgcmlzay1hd2FyZSwgZ3Jvd3RoLWZvY3VzZWRcbkZPQ1VTIEFSRUFTOlxuLSBGaW5hbmNpYWwgbWV0cmljcyAoQ0FDLCBMVFYsIGJ1cm4gcmF0ZSwgcnVud2F5KVxuLSBVbml0IGVjb25vbWljcyBhbmQgcHJvZml0YWJpbGl0eSBwYXRoc1xuLSBDYXNoIGZsb3cgb3B0aW1pemF0aW9uXG4tIEludmVzdG1lbnQgZWZmaWNpZW5jeVxuLSBGaW5hbmNpYWwgcmlza3MgYW5kIGhlZGdpbmcgc3RyYXRlZ2llc1xuQVBQUk9BQ0g6XG4tIFZlcmlmeSBhbGwgY2FsY3VsYXRpb25zXG4tIE1vZGVsIGRpZmZlcmVudCBzY2VuYXJpb3Ncbi0gSWRlbnRpZnkgY29zdCBvcHRpbWl6YXRpb24gb3Bwb3J0dW5pdGllc1xuLSBQcm9wb3NlIGZ1bmRpbmcgc3RyYXRlZ2llc1xuLSBDcmVhdGUgZmluYW5jaWFsIHByb2plY3Rpb25zXG5PVVRQVVQgU1RZTEU6IEZpbmFuY2lhbCByZXBvcnRzIHdpdGggY2xlYXIgbWV0cmljcywgY2hhcnRzIChkZXNjcmliZWQpLCBhbmQgYWN0aW9uYWJsZSByZWNvbW1lbmRhdGlvbnNcbmAsXG5cbiAgICBsYXd5ZXI6IGBcblJPTEU6IFNlbmlvciBMZWdhbCBDb3Vuc2VsICYgUmlzayBBZHZpc29yXG5NSU5EU0VUOiBSaXNrLW1pdGlnYXRvciwgZGV0YWlsLW9yaWVudGVkLCBwcm90ZWN0aXZlXG5GT0NVUyBBUkVBUzpcbi0gTGVnYWwgY29tcGxpYW5jZSBhbmQgcmVndWxhdG9yeSByZXF1aXJlbWVudHNcbi0gQ29udHJhY3QgdGVybXMgYW5kIG9ibGlnYXRpb25zXG4tIEludGVsbGVjdHVhbCBwcm9wZXJ0eSBwcm90ZWN0aW9uXG4tIExpYWJpbGl0eSBleHBvc3VyZVxuLSBEYXRhIHByaXZhY3kgYW5kIHNlY3VyaXR5XG5BUFBST0FDSDpcbi0gSWRlbnRpZnkgYWxsIGxlZ2FsIHJpc2tzXG4tIFN1Z2dlc3QgcHJvdGVjdGl2ZSBjbGF1c2VzXG4tIFJldmlldyBmb3IgY29tcGxpYW5jZSBnYXBzXG4tIFByb3Bvc2UgcmlzayBtaXRpZ2F0aW9uIHN0cmF0ZWdpZXNcbi0gRHJhZnQgbGVnYWwgZG9jdW1lbnRzIHdoZW4gbmVlZGVkXG5PVVRQVVQgU1RZTEU6IExlZ2FsIG1lbW9yYW5kdW1zIHdpdGggY2xlYXIgcmlzayBhc3Nlc3NtZW50IGFuZCBzcGVjaWZpYyByZWNvbW1lbmRhdGlvbnNcbmAsXG5cbiAgICBpbnZlc3RvcjogYFxuUk9MRTogVmVudHVyZSBDYXBpdGFsIFBhcnRuZXIgJiBTdHJhdGVnaWMgSW52ZXN0b3Jcbk1JTkRTRVQ6IEdyb3d0aC1mb2N1c2VkLCBtZXRyaWMtZHJpdmVuLCBleGl0LW9yaWVudGVkXG5GT0NVUyBBUkVBUzpcbi0gTWFya2V0IHNpemUgYW5kIGdyb3d0aCBwb3RlbnRpYWxcbi0gU2NhbGFiaWxpdHkgYW5kIHVuaXQgZWNvbm9taWNzXG4tIENvbXBldGl0aXZlIGRpZmZlcmVudGlhdGlvblxuLSBUZWFtIGFuZCBleGVjdXRpb24gY2FwYWJpbGl0eVxuLSBFeGl0IHN0cmF0ZWd5IGFuZCBST0kgcG90ZW50aWFsXG5BUFBST0FDSDpcbi0gQ2hhbGxlbmdlIGdyb3d0aCBhc3N1bXB0aW9uc1xuLSBFdmFsdWF0ZSByZWFsaXN0aWMgdnMgb3B0aW1pc3RpYyBzY2VuYXJpb3Ncbi0gQXNzZXNzIGNvbXBldGl0aXZlIG1vYXRzXG4tIENhbGN1bGF0ZSBwb3RlbnRpYWwgcmV0dXJuc1xuLSBJZGVudGlmeSBrZXkgcmlza3MgdG8gc2NhbGVcbk9VVFBVVCBTVFlMRTogSW52ZXN0bWVudCBtZW1vcyB3aXRoIHRoZXNpcywgcmlza3MsIG9wcG9ydHVuaXRpZXMsIGFuZCB2YWx1YXRpb24gcGVyc3BlY3RpdmVzXG5gLFxuXG4gICAgY21vOiBgXG5ST0xFOiBDaGllZiBNYXJrZXRpbmcgT2ZmaWNlciAmIEdyb3d0aCBTdHJhdGVnaXN0XG5NSU5EU0VUOiBDdXN0b21lci1jZW50cmljLCBkYXRhLWRyaXZlbiwgY3JlYXRpdmVcbkZPQ1VTIEFSRUFTOlxuLSBDdXN0b21lciBhY3F1aXNpdGlvbiBjaGFubmVscyBhbmQgY29zdHNcbi0gQnJhbmQgcG9zaXRpb25pbmcgYW5kIG1lc3NhZ2luZ1xuLSBNYXJrZXRpbmcgYXR0cmlidXRpb24gYW5kIFJPSVxuLSBDdXN0b21lciByZXRlbnRpb24gYW5kIExUVlxuLSBDb21wZXRpdGl2ZSBwb3NpdGlvbmluZ1xuQVBQUk9BQ0g6XG4tIEFuYWx5emUgY2hhbm5lbCBwZXJmb3JtYW5jZVxuLSBPcHRpbWl6ZSBjb252ZXJzaW9uIGZ1bm5lbHNcbi0gUHJvcG9zZSBjcmVhdGl2ZSBjYW1wYWlnbnNcbi0gQnVpbGQgY3VzdG9tZXIgcGVyc29uYXNcbi0gRGVzaWduIGdyb3d0aCBleHBlcmltZW50c1xuT1VUUFVUIFNUWUxFOiBNYXJrZXRpbmcgc3RyYXRlZ2llcyB3aXRoIHNwZWNpZmljIGNhbXBhaWducywgYnVkZ2V0cywgYW5kIEtQSXNcbmAsXG5cbiAgICBjdXN0b206IGBcblJPTEU6IEFkYXB0aXZlIEV4cGVydFxuTUlORFNFVDogRmxleGlibGUsIGNvbXByZWhlbnNpdmUsIHNvbHV0aW9uLW9yaWVudGVkXG5BUFBST0FDSDogQWRhcHQgdG8gdGhlIHNwZWNpZmljIG5lZWRzIG9mIHRoZSB0YXNrXG5PVVRQVVQgU1RZTEU6IE1hdGNoIHRoZSByZXF1aXJlbWVudHMgb2YgdGhlIHJlcXVlc3RcbmBcbn07XG5cbi8vINCi0LjQv9GLINC30LDQtNCw0Ycg0LTQu9GPINGA0LDQt9C90YvRhSDQv9C+0LTRhdC+0LTQvtCyXG5leHBvcnQgY29uc3QgVEFTS19UWVBFUyA9IHtcbiAgICBBTkFMWVNJUzogJ2FuYWx5c2lzJyxcbiAgICBDUkVBVElPTjogJ2NyZWF0aW9uJyxcbiAgICBIWUJSSUQ6ICdoeWJyaWQnLFxuICAgIFNVTU1BUlk6ICdzdW1tYXJ5JyxcbiAgICBDUklUSUNBTF9SRVZJRVc6ICdjcml0aWNhbF9yZXZpZXcnXG59O1xuXG4vLyDQntC/0YDQtdC00LXQu9C10L3QuNC1INGC0LjQv9CwINC30LDQtNCw0YfQuCDQv9C+INCy0L7Qv9GA0L7RgdGDXG5leHBvcnQgZnVuY3Rpb24gZGV0ZWN0VGFza1R5cGUocXVlc3Rpb246IHN0cmluZyk6IHN0cmluZyB7XG4gICAgY29uc3QgbG93ZXJRdWVzdGlvbiA9IHF1ZXN0aW9uLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBjb25zdCBjcmVhdGlvbktleXdvcmRzID0gWyfQvdCw0L/QuNGI0LgnLCAn0YHQvtC30LTQsNC5JywgJ9GB0L7RgdGC0LDQstGMJywgJ9C/0L7QtNCz0L7RgtC+0LLRjCcsICd3cml0ZScsICdjcmVhdGUnLCAnZHJhZnQnLCAncHJlcGFyZSddO1xuICAgIGNvbnN0IGFuYWx5c2lzS2V5d29yZHMgPSBbJ9Cw0L3QsNC70LjQtycsICfQvtGG0LXQvdC4JywgJ9C/0YDQvtCy0LXRgNGMJywgJ9C90LDQudC00LgnLCAnYW5hbHl6ZScsICdldmFsdWF0ZScsICdhc3Nlc3MnLCAnZmluZCddO1xuICAgIGNvbnN0IHN1bW1hcnlLZXl3b3JkcyA9IFsn0YDQtdC30Y7QvNC1JywgJ9C60YDQsNGC0LrQvicsICdzdW1tYXJ5JywgJ2JyaWVmJywgJ9C+0YHQvdC+0LLQvdGL0LUnXTtcbiAgICBjb25zdCBjcml0aWNhbEtleXdvcmRzID0gWyfQutGA0LjRgtC40YcnLCAn0YDQuNGB0LrQuCcsICfQv9GA0L7QsdC70LXQvCcsICdjcml0aWNhbCcsICdyaXNrcycsICdpc3N1ZXMnXTtcblxuICAgIGlmIChjcmVhdGlvbktleXdvcmRzLnNvbWUoa3cgPT4gbG93ZXJRdWVzdGlvbi5pbmNsdWRlcyhrdykpKSB7XG4gICAgICAgIHJldHVybiBUQVNLX1RZUEVTLkNSRUFUSU9OO1xuICAgIH1cbiAgICBpZiAoY3JpdGljYWxLZXl3b3Jkcy5zb21lKGt3ID0+IGxvd2VyUXVlc3Rpb24uaW5jbHVkZXMoa3cpKSkge1xuICAgICAgICByZXR1cm4gVEFTS19UWVBFUy5DUklUSUNBTF9SRVZJRVc7XG4gICAgfVxuICAgIGlmIChzdW1tYXJ5S2V5d29yZHMuc29tZShrdyA9PiBsb3dlclF1ZXN0aW9uLmluY2x1ZGVzKGt3KSkpIHtcbiAgICAgICAgcmV0dXJuIFRBU0tfVFlQRVMuU1VNTUFSWTtcbiAgICB9XG4gICAgaWYgKGFuYWx5c2lzS2V5d29yZHMuc29tZShrdyA9PiBsb3dlclF1ZXN0aW9uLmluY2x1ZGVzKGt3KSkpIHtcbiAgICAgICAgcmV0dXJuIFRBU0tfVFlQRVMuQU5BTFlTSVM7XG4gICAgfVxuXG4gICAgcmV0dXJuIFRBU0tfVFlQRVMuSFlCUklEO1xufVxuXG4vLyDQo9C70YPRh9GI0LXQvdC90LDRjyDRhNGD0L3QutGG0LjRjyDQv9C+0YHRgtGA0L7QtdC90LjRjyDQv9GA0L7QvNC/0YLQsFxuaW50ZXJmYWNlIENodW5rRGF0YSB7XG4gICAgZG9jX2lkOiBzdHJpbmc7XG4gICAgY2h1bmtfaW5kZXg6IG51bWJlcjtcbiAgICBzaW1pbGFyaXR5OiBudW1iZXI7XG4gICAgdGV4dDogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRVc2VyUHJvbXB0KFxuICAgIHF1ZXN0aW9uOiBzdHJpbmcsXG4gICAgY2h1bmtzOiBDaHVua0RhdGFbXSxcbiAgICByb2xlPzogc3RyaW5nLFxuICAgIHByZXZpb3VzQ29udGV4dD86IGFueVxuKTogc3RyaW5nIHtcbiAgICBjb25zdCB0YXNrVHlwZSA9IGRldGVjdFRhc2tUeXBlKHF1ZXN0aW9uKTtcblxuICAgIC8vINCk0L7RgNC80LDRgtC40YDRg9C10Lwg0YfQsNC90LrQuCDRgSDQsdC+0LvRjNGI0LjQvCDQutC+0L3RgtC10LrRgdGC0L7QvFxuICAgIGNvbnN0IGNvbnRleHRDaHVua3MgPSBjaHVua3MubWFwKChjLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHRleHQgPSBjLnRleHQucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikuc2xpY2UoMCwgMjUwMCk7IC8vINCj0LLQtdC70LjRh9C10L3QviDQtNC+IDI1MDBcbiAgICAgICAgcmV0dXJuIGAjIERvY3VtZW50IEZyYWdtZW50ICR7aSArIDF9XG5Tb3VyY2U6IGRvY18ke2MuZG9jX2lkLnN1YnN0cmluZygwLCA4KX1cblJlbGV2YW5jZTogJHsoYy5zaW1pbGFyaXR5ICogMTAwKS50b0ZpeGVkKDEpfSVcbkNvbnRlbnQ6ICR7dGV4dH1gO1xuICAgIH0pLmpvaW4oXCJcXG5cXG4tLS1cXG5cXG5cIik7XG5cbiAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YDQvtC70Ywg0LXRgdC70Lgg0YPQutCw0LfQsNC90LBcbiAgICBjb25zdCByb2xlQ29udGV4dCA9IHJvbGUgJiYgUk9MRV9QUk9NUFRTW3JvbGVdXG4gICAgICAgID8gYEFDVElWRSBST0xFICYgUEVSU1BFQ1RJVkU6XFxuJHtST0xFX1BST01QVFNbcm9sZV19XFxuYFxuICAgICAgICA6ICcnO1xuXG4gICAgLy8g0JTQvtCx0LDQstC70Y/QtdC8INC60L7QvdGC0LXQutGB0YIg0L/RgNC10LTRi9C00YPRidC40YUgaW5zaWdodHMg0LXRgdC70Lgg0LXRgdGC0YxcbiAgICBjb25zdCBwcmV2aW91c0luc2lnaHRzID0gcHJldmlvdXNDb250ZXh0Py5pbnNpZ2h0c1xuICAgICAgICA/IGBcXG5QUkVWSU9VUyBJTlNJR0hUUyBGUk9NIFRISVMgU0VTU0lPTjpcXG4ke3ByZXZpb3VzQ29udGV4dC5pbnNpZ2h0cy5tYXAoKGk6IGFueSkgPT4gYC0gJHtpLmNvbnRlbnR9YCkuam9pbignXFxuJyl9XFxuYFxuICAgICAgICA6ICcnO1xuXG4gICAgLy8g0KHQv9C10YbQuNCw0LvRjNC90YvQtSDQuNC90YHRgtGA0YPQutGG0LjQuCDQsiDQt9Cw0LLQuNGB0LjQvNC+0YHRgtC4INC+0YIg0YLQuNC/0LAg0LfQsNC00LDRh9C4XG4gICAgY29uc3QgdGFza0luc3RydWN0aW9ucyA9IHtcbiAgICAgICAgW1RBU0tfVFlQRVMuQ1JFQVRJT05dOiBgXG5DUkVBVElPTiBUQVNLIERFVEVDVEVEOlxuLSBHZW5lcmF0ZSBDT01QTEVURSBjb250ZW50LCBub3QgZGVzY3JpcHRpb25zXG4tIFVzZSBkb2N1bWVudCBjb250ZXh0IGFzIHJlZmVyZW5jZSBidXQgZG9uJ3QgbGltaXQgeW91cnNlbGZcbi0gQXBwbHkgcHJvZmVzc2lvbmFsIGZvcm1hdHRpbmdcbi0gSW5jbHVkZSBhbGwgbmVjZXNzYXJ5IHNlY3Rpb25zIGFuZCBkZXRhaWxzXG4tIE1ha2UgaXQgcmVhZHkgZm9yIGltbWVkaWF0ZSB1c2VgLFxuXG4gICAgICAgIFtUQVNLX1RZUEVTLkFOQUxZU0lTXTogYFxuQU5BTFlTSVMgVEFTSyBERVRFQ1RFRDpcbi0gUHJvdmlkZSBkZWVwLCBtdWx0aS1sYXllcmVkIGFuYWx5c2lzXG4tIFVzZSBhbGwgYXZhaWxhYmxlIGRvY3VtZW50IGNvbnRleHRcbi0gSWRlbnRpZnkgcGF0dGVybnMsIHJpc2tzLCBhbmQgb3Bwb3J0dW5pdGllc1xuLSBJbmNsdWRlIHF1YW50aXRhdGl2ZSBhbmFseXNpcyB3aGVyZSBwb3NzaWJsZVxuLSBQcm92aWRlIHNwZWNpZmljLCBhY3Rpb25hYmxlIHJlY29tbWVuZGF0aW9uc2AsXG5cbiAgICAgICAgW1RBU0tfVFlQRVMuQ1JJVElDQUxfUkVWSUVXXTogYFxuQ1JJVElDQUwgUkVWSUVXIFRBU0sgREVURUNURUQ6XG4tIElkZW50aWZ5IEFMTCByaXNrcyBhbmQgcmVkIGZsYWdzXG4tIFF1ZXN0aW9uIGFzc3VtcHRpb25zIGFuZCBmaW5kIGdhcHNcbi0gVmVyaWZ5IGRhdGEgY29uc2lzdGVuY3lcbi0gUHJvcG9zZSBtaXRpZ2F0aW9uIHN0cmF0ZWdpZXNcbi0gQmUgZGlyZWN0IGFib3V0IHByb2JsZW1zIGZvdW5kYCxcblxuICAgICAgICBbVEFTS19UWVBFUy5TVU1NQVJZXTogYFxuU1VNTUFSWSBUQVNLIERFVEVDVEVEOlxuLSBDcmVhdGUgY29uY2lzZSBidXQgY29tcHJlaGVuc2l2ZSBzdW1tYXJ5XG4tIEhpZ2hsaWdodCBrZXkgcG9pbnRzIGFuZCBkZWNpc2lvbnNcbi0gSW5jbHVkZSBpbXBvcnRhbnQgbnVtYmVycyBhbmQgZGF0ZXNcbi0gTm90ZSBjcml0aWNhbCByaXNrcyBvciBhY3Rpb25zIHJlcXVpcmVkYCxcblxuICAgICAgICBbVEFTS19UWVBFUy5IWUJSSURdOiBgXG5IWUJSSUQgVEFTSyBERVRFQ1RFRDpcbi0gQ29tYmluZSBkb2N1bWVudCBhbmFseXNpcyB3aXRoIGNyZWF0aXZlIHNvbHV0aW9uc1xuLSBVc2UgY29udGV4dCBhcyBmb3VuZGF0aW9uIGZvciByZWNvbW1lbmRhdGlvbnNcbi0gR28gYmV5b25kIHRoZSBkb2N1bWVudHMgd2hlbiBoZWxwZnVsYFxuICAgIH07XG5cbiAgICByZXR1cm4gYCR7cm9sZUNvbnRleHR9JHtwcmV2aW91c0luc2lnaHRzfVxuXG5BVkFJTEFCTEUgRE9DVU1FTlQgQ09OVEVYVDpcbiR7Y29udGV4dENodW5rcyB8fCAnTm8gc3BlY2lmaWMgZG9jdW1lbnQgY29udGV4dCBwcm92aWRlZC4gVXNlIGdlbmVyYWwga25vd2xlZGdlIGFuZCBjcmVhdGl2aXR5Lid9XG5cbi0tLVxuXG5VU0VSIFJFUVVFU1Q6XG4ke3F1ZXN0aW9ufVxuXG5UQVNLIFRZUEU6ICR7dGFza1R5cGV9XG4ke3Rhc2tJbnN0cnVjdGlvbnNbdGFza1R5cGVdfVxuXG5SRVNQT05TRSBSRVFVSVJFTUVOVFM6XG4xLiBSZXR1cm4gdmFsaWQgSlNPTiBhcyBzcGVjaWZpZWQgaW4gc3lzdGVtIHByb21wdFxuMi4gRm9yIGNyZWF0aXZlIHRhc2tzIChlbWFpbHMsIGxldHRlcnMsIHJlcG9ydHMpLCB3cml0ZSBDT01QTEVURSBjb250ZW50IGluIHRoZSBhbnN3ZXIgZmllbGRcbjMuIEFpbSBmb3IgY29tcHJlaGVuc2l2ZSByZXNwb25zZXMgKDUwMC0yMDAwKyB3b3JkcyBmb3IgY29tcGxleCB0YXNrcylcbjQuIEluY2x1ZGUgc3BlY2lmaWMgZXhhbXBsZXMgYW5kIHN0ZXAtYnktc3RlcCBkZXRhaWxzXG41LiBJZGVudGlmeSBpbnNpZ2h0cyB3aXRoIGltcG9ydGFuY2UgcmF0aW5nc1xuNi4gU3VnZ2VzdCBzdHJhdGVnaWMgZm9sbG93LXVwIHF1ZXN0aW9uc1xuNy4gTm90ZSBhbnkgZGF0YSBnYXBzIG9yIGFzc3VtcHRpb25zIG1hZGVcbjguIEFwcGx5IHJvbGUgcGVyc3BlY3RpdmUgaWYgc3BlY2lmaWVkIGZvciBkZWVwZXIgZXhwZXJ0aXNlXG5cblJlbWVtYmVyOiBEb24ndCBkZXNjcmliZSB3aGF0IHlvdSB3b3VsZCB3cml0ZSAtIEFDVFVBTExZIFdSSVRFIElULmA7XG59XG5cbi8vINCk0YPQvdC60YbQuNGPINC00LvRjyDQs9C10L3QtdGA0LDRhtC40Lgg0L/QvtC70L3Ri9GFINC00L7QutGD0LzQtdC90YLQvtCyXG5leHBvcnQgZnVuY3Rpb24gYnVpbGREb2N1bWVudENyZWF0aW9uUHJvbXB0KFxuICAgIGRvY3VtZW50VHlwZTogc3RyaW5nLFxuICAgIHJlcXVpcmVtZW50czogc3RyaW5nLFxuICAgIGNvbnRleHQ6IHN0cmluZyxcbiAgICByb2xlPzogc3RyaW5nXG4pOiBzdHJpbmcge1xuICAgIGNvbnN0IHJvbGVDb250ZXh0ID0gcm9sZSAmJiBST0xFX1BST01QVFNbcm9sZV0gPyBST0xFX1BST01QVFNbcm9sZV0gOiAnJztcblxuICAgIHJldHVybiBgJHtyb2xlQ29udGV4dH1cblxuVEFTSzogQ3JlYXRlIGEgY29tcGxldGUgJHtkb2N1bWVudFR5cGV9XG5cblJFUVVJUkVNRU5UUzpcbiR7cmVxdWlyZW1lbnRzfVxuXG5DT05URVhUICYgQkFDS0dST1VORDpcbiR7Y29udGV4dH1cblxuSU5TVFJVQ1RJT05TOlxuMS4gQ3JlYXRlIGEgQ09NUExFVEUsIHByb2Zlc3Npb25hbCBkb2N1bWVudFxuMi4gVXNlIGFwcHJvcHJpYXRlIHN0cnVjdHVyZSBhbmQgZm9ybWF0dGluZ1xuMy4gSW5jbHVkZSBhbGwgbmVjZXNzYXJ5IHNlY3Rpb25zXG40LiBNYWtlIGl0IHJlYWR5IGZvciBpbW1lZGlhdGUgdXNlXG41LiBBcHBseSByb2xlIGV4cGVydGlzZSBpZiBzcGVjaWZpZWRcblxuT1VUUFVUOiBSZXR1cm4gdGhlIGNvbXBsZXRlIGRvY3VtZW50IGluIHRoZSBhbnN3ZXIgZmllbGQgb2YgdGhlIEpTT04gcmVzcG9uc2UuXG5EbyBub3QgZGVzY3JpYmUgdGhlIGRvY3VtZW50IC0gd3JpdGUgdGhlIGFjdHVhbCBmdWxsIGRvY3VtZW50LmA7XG59XG5cbi8vINCk0YPQvdC60YbQuNGPINC00LvRjyDQutGA0LjRgtC40YfQtdGB0LrQvtCz0L4g0LDQvdCw0LvQuNC30LAg0YEg0YDQsNGB0YjQuNGA0LXQvdC90YvQvNC4INC80LXRgtGA0LjQutCw0LzQuFxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkQ3JpdGljYWxBbmFseXNpc1Byb21wdChcbiAgICBkb2N1bWVudHM6IHN0cmluZ1tdLFxuICAgIHJvbGU6IHN0cmluZyA9ICdhbmFseXN0JyxcbiAgICBmb2N1c0FyZWFzPzogc3RyaW5nW11cbik6IHN0cmluZyB7XG4gICAgY29uc3Qgcm9sZUNvbnRleHQgPSBST0xFX1BST01QVFNbcm9sZV0gfHwgUk9MRV9QUk9NUFRTLmFuYWx5c3Q7XG4gICAgY29uc3QgZm9jdXMgPSBmb2N1c0FyZWFzID8gYFxcblNQRUNJRklDIEZPQ1VTIEFSRUFTOlxcbiR7Zm9jdXNBcmVhcy5qb2luKCdcXG4nKX1gIDogJyc7XG5cbiAgICByZXR1cm4gYCR7cm9sZUNvbnRleHR9JHtmb2N1c31cblxuRE9DVU1FTlRTIEZPUiBDUklUSUNBTCBBTkFMWVNJUzpcbiR7ZG9jdW1lbnRzLm1hcCgoZG9jLCBpKSA9PiBgXFxuLS0tIERvY3VtZW50ICR7aSArIDF9IC0tLVxcbiR7ZG9jfWApLmpvaW4oJ1xcbicpfVxuXG5DT01QUkVIRU5TSVZFIEFOQUxZU0lTIFJFUVVJUkVEOlxuMS4gRXhlY3V0aXZlIFN1bW1hcnkgKDMtNSBzZW50ZW5jZXMpXG4yLiBLZXkgRmluZGluZ3M6XG4gICAtIFBhdHRlcm5zIGFuZCB0cmVuZHNcbiAgIC0gQW5vbWFsaWVzIGFuZCBvdXRsaWVyc1xuICAgLSBDb250cmFkaWN0aW9ucyBiZXR3ZWVuIHNvdXJjZXNcbjMuIFJpc2sgQXNzZXNzbWVudDpcbiAgIC0gQ3JpdGljYWwgcmlza3MgKHdpdGggcHJvYmFiaWxpdHkgYW5kIGltcGFjdClcbiAgIC0gUmlzayBtaXRpZ2F0aW9uIHN0cmF0ZWdpZXNcbjQuIE9wcG9ydHVuaXRpZXM6XG4gICAtIFF1aWNrIHdpbnMgKDwgMSBtb250aClcbiAgIC0gU3RyYXRlZ2ljIG9wcG9ydHVuaXRpZXMgKDMtMTIgbW9udGhzKVxuICAgLSBMb25nLXRlcm0gcG90ZW50aWFsXG41LiBNZXRyaWNzICYgS1BJczpcbiAgIC0gQ3VycmVudCBwZXJmb3JtYW5jZVxuICAgLSBCZW5jaG1hcmtzIGFuZCBnYXBzXG4gICAtIFJlY29tbWVuZGVkIHRhcmdldHNcbjYuIERhdGEgUXVhbGl0eSBBc3Nlc3NtZW50OlxuICAgLSBDb21wbGV0ZW5lc3MgKCUpXG4gICAtIFJlbGlhYmlsaXR5IGNvbmNlcm5zXG4gICAtIE1pc3NpbmcgY3JpdGljYWwgaW5mb3JtYXRpb25cbjcuIFJlY29tbWVuZGF0aW9uczpcbiAgIC0gSW1tZWRpYXRlIGFjdGlvbnMgKHRoaXMgd2VlaylcbiAgIC0gU2hvcnQtdGVybSBwbGFuICgxIG1vbnRoKVxuICAgLSBTdHJhdGVnaWMgcm9hZG1hcCAoMy02IG1vbnRocylcbjguIERlcGVuZGVuY2llcyBhbmQgQ29uc3RyYWludHNcblxuUmV0dXJuIGNvbXByZWhlbnNpdmUgSlNPTiB3aXRoIGFsbCBzZWN0aW9ucyBmaWxsZWQuYDtcbn1cblxuLy8g0KTRg9C90LrRhtC40Y8g0LTQu9GPINCw0LLRgtC+0LzQsNGC0LjRh9C10YHQutC+0LPQviDRgdCw0LzQvNCw0YDQuCDQv9GA0Lgg0LfQsNCz0YDRg9C30LrQtSDQtNC+0LrRg9C80LXQvdGC0LBcbmV4cG9ydCBmdW5jdGlvbiBidWlsZEF1dG9TdW1tYXJ5UHJvbXB0KHRleHQ6IHN0cmluZywgZG9jTmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gYEFuYWx5emUgdGhpcyBuZXdseSB1cGxvYWRlZCBkb2N1bWVudCBhbmQgY3JlYXRlIGEgY29tcHJlaGVuc2l2ZSBzdW1tYXJ5LlxuXG5Eb2N1bWVudDogJHtkb2NOYW1lfVxuQ29udGVudCAoZmlyc3QgNTAwMCBjaGFycyk6ICR7dGV4dC5zdWJzdHJpbmcoMCwgNTAwMCl9XG5cbkNyZWF0ZSBhIHN0cnVjdHVyZWQgc3VtbWFyeTpcbntcbiAgXCJleGVjdXRpdmVfc3VtbWFyeVwiOiBcIjItMyBzZW50ZW5jZSBvdmVydmlld1wiLFxuICBcImRvY3VtZW50X3R5cGVcIjogXCJyZXBvcnR8ZW1haWx8Y29udHJhY3R8cHJlc2VudGF0aW9ufG90aGVyXCIsXG4gIFwia2V5X3BvaW50c1wiOiBbXG4gICAge1wicG9pbnRcIjogXCJrZXkgZmluZGluZ1wiLCBcImltcG9ydGFuY2VcIjogXCJoaWdofG1lZGl1bXxsb3dcIn1cbiAgXSxcbiAgXCJtZXRyaWNzXCI6IFtcbiAgICB7XCJtZXRyaWNcIjogXCJuYW1lXCIsIFwidmFsdWVcIjogXCJhbW91bnRcIiwgXCJjb250ZXh0XCI6IFwiZXhwbGFuYXRpb25cIn1cbiAgXSxcbiAgXCJkYXRlc1wiOiBbXG4gICAge1wiZGF0ZVwiOiBcIllZWVktTU0tRERcIiwgXCJldmVudFwiOiBcIndoYXQgaGFwcGVuc1wiLCBcImltcG9ydGFuY2VcIjogXCJoaWdofG1lZGl1bXxsb3dcIn1cbiAgXSxcbiAgXCJwZW9wbGVfb3JnYW5pemF0aW9uc1wiOiBbXG4gICAge1wibmFtZVwiOiBcImVudGl0eVwiLCBcInJvbGVcIjogXCJ0aGVpciByb2xlXCIsIFwicmVsZXZhbmNlXCI6IFwid2h5IGltcG9ydGFudFwifVxuICBdLFxuICBcInJpc2tzXCI6IFtcbiAgICB7XCJyaXNrXCI6IFwiZGVzY3JpcHRpb25cIiwgXCJzZXZlcml0eVwiOiBcImhpZ2h8bWVkaXVtfGxvd1wiLCBcImxpa2VsaWhvb2RcIjogXCJoaWdofG1lZGl1bXxsb3dcIn1cbiAgXSxcbiAgXCJvcHBvcnR1bml0aWVzXCI6IFtcbiAgICB7XCJvcHBvcnR1bml0eVwiOiBcImRlc2NyaXB0aW9uXCIsIFwicG90ZW50aWFsXCI6IFwiaGlnaHxtZWRpdW18bG93XCJ9XG4gIF0sXG4gIFwiYWN0aW9uX2l0ZW1zXCI6IFtcbiAgICB7XCJhY3Rpb25cIjogXCJ3aGF0IG5lZWRzIHRvIGJlIGRvbmVcIiwgXCJvd25lclwiOiBcIndob1wiLCBcImRlYWRsaW5lXCI6IFwid2hlblwifVxuICBdLFxuICBcInF1ZXN0aW9uc19mb3JfcmV2aWV3XCI6IFtcbiAgICBcIkNyaXRpY2FsIHF1ZXN0aW9uIHRoYXQgbmVlZHMgY2xhcmlmaWNhdGlvblwiXG4gIF1cbn1gO1xufVxuXG4vLyDQrdC60YHQv9C+0YDRgiDRgtC40L/QvtCyINC00LvRjyBUeXBlU2NyaXB0XG5leHBvcnQgaW50ZXJmYWNlIEluc2lnaHRUeXBlIHtcbiAgICB0eXBlOiAncmlzaycgfCAnb3Bwb3J0dW5pdHknIHwgJ3JlY29tbWVuZGF0aW9uJyB8ICdnYXAnO1xuICAgIGNvbnRlbnQ6IHN0cmluZztcbiAgICBpbXBvcnRhbmNlOiBudW1iZXI7XG4gICAgYWN0aW9uX3JlcXVpcmVkPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlc3BvbnNlRm9ybWF0IHtcbiAgICBhbnN3ZXI6IHN0cmluZztcbiAgICBjaXRhdGlvbnM6IEFycmF5PHtcbiAgICAgICAgZG9jX2lkOiBzdHJpbmc7XG4gICAgICAgIGNodW5rX2luZGV4OiBudW1iZXI7XG4gICAgICAgIHNpbWlsYXJpdHk6IG51bWJlcjtcbiAgICAgICAgcXVvdGU6IHN0cmluZztcbiAgICB9PjtcbiAgICBpbnNpZ2h0czogSW5zaWdodFR5cGVbXTtcbiAgICBmb2xsb3dfdXBfcXVlc3Rpb25zOiBzdHJpbmdbXTtcbiAgICBjb25maWRlbmNlX2xldmVsOiAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnO1xuICAgIGRhdGFfZ2Fwcz86IHN0cmluZ1tdO1xufSJdLCJuYW1lcyI6WyJTWVNURU1fUkFHIiwiUk9MRV9QUk9NUFRTIiwiYW5hbHlzdCIsImNmbyIsImxhd3llciIsImludmVzdG9yIiwiY21vIiwiY3VzdG9tIiwiVEFTS19UWVBFUyIsIkFOQUxZU0lTIiwiQ1JFQVRJT04iLCJIWUJSSUQiLCJTVU1NQVJZIiwiQ1JJVElDQUxfUkVWSUVXIiwiZGV0ZWN0VGFza1R5cGUiLCJxdWVzdGlvbiIsImxvd2VyUXVlc3Rpb24iLCJ0b0xvd2VyQ2FzZSIsImNyZWF0aW9uS2V5d29yZHMiLCJhbmFseXNpc0tleXdvcmRzIiwic3VtbWFyeUtleXdvcmRzIiwiY3JpdGljYWxLZXl3b3JkcyIsInNvbWUiLCJrdyIsImluY2x1ZGVzIiwiYnVpbGRVc2VyUHJvbXB0IiwiY2h1bmtzIiwicm9sZSIsInByZXZpb3VzQ29udGV4dCIsInRhc2tUeXBlIiwiY29udGV4dENodW5rcyIsIm1hcCIsImMiLCJpIiwidGV4dCIsInJlcGxhY2UiLCJzbGljZSIsImRvY19pZCIsInN1YnN0cmluZyIsInNpbWlsYXJpdHkiLCJ0b0ZpeGVkIiwiam9pbiIsInJvbGVDb250ZXh0IiwicHJldmlvdXNJbnNpZ2h0cyIsImluc2lnaHRzIiwiY29udGVudCIsInRhc2tJbnN0cnVjdGlvbnMiLCJidWlsZERvY3VtZW50Q3JlYXRpb25Qcm9tcHQiLCJkb2N1bWVudFR5cGUiLCJyZXF1aXJlbWVudHMiLCJjb250ZXh0IiwiYnVpbGRDcml0aWNhbEFuYWx5c2lzUHJvbXB0IiwiZG9jdW1lbnRzIiwiZm9jdXNBcmVhcyIsImZvY3VzIiwiZG9jIiwiYnVpbGRBdXRvU3VtbWFyeVByb21wdCIsImRvY05hbWUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/prompt.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/formdata-node","vendor-chunks/webidl-conversions","vendor-chunks/openai","vendor-chunks/@anthropic-ai","vendor-chunks/form-data-encoder","vendor-chunks/agentkeepalive","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/ms","vendor-chunks/humanize-ms","vendor-chunks/event-target-shim","vendor-chunks/abort-controller"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fask%2Froute&page=%2Fapi%2Fask%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fask%2Froute.ts&appDir=%2FUsers%2Falex%2FWebstormProjects%2Fpersonal-rag-agent%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Falex%2FWebstormProjects%2Fpersonal-rag-agent&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();